<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wenning</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20260101-welcome-v2">
    <!-- Driver.js for Product Tour (本地文件) -->
    <link rel="stylesheet" href="/static/vendor/driver.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <img src="/static/logo.png" alt="Wenning" class="logo">
            </div>

            <!-- Showcase Buttons -->
            <div class="showcase-buttons" id="showcase-buttons">
                <!-- 动态加载showcase按钮 -->
            </div>

            <div class="model-selector">
                <label for="model-select">Model</label>
                <select id="model-select">
                    <!-- 动态加载 -->
                </select>
                <button id="theme-toggle" class="theme-toggle" title="Toggle Theme">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                </button>
                <button id="help-tour-btn" class="theme-toggle" title="帮助导览">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <path d="M12 17h.01"/>
                    </svg>
                </button>
                <button id="feedback-btn" class="feedback-btn" title="Feedback">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </button>
                <div class="account" id="account">
                    <button id="account-btn" class="account-btn" title="Account">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </button>
                    <div id="account-menu" class="account-menu" style="display:none;">
                        <div class="account-row" id="account-username">Not signed in</div>
                        <button id="logout-btn" class="account-logout">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Showcase Modal -->
    <div class="showcase-modal" id="showcase-modal">
        <div class="showcase-modal-overlay" id="showcase-modal-overlay"></div>
        <div class="showcase-modal-content">
            <button class="showcase-modal-close" id="showcase-modal-close">✕</button>
            <div class="showcase-modal-body">
                <!-- Left: Prompt Card -->
                <div class="showcase-prompt-section">
                    <div class="showcase-prompt-header">
                        <h3 id="showcase-case-title">示例标题</h3>
                        <p id="showcase-case-description">示例描述</p>
                    </div>
                    <div class="showcase-prompt-card">
                        <div class="showcase-prompt-toolbar">
                            <span class="showcase-prompt-label">Prompt</span>
                            <div class="showcase-prompt-actions">
                                <button class="showcase-btn showcase-btn-secondary" id="showcase-copy-btn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    复制
                                </button>
                                <button class="showcase-btn showcase-btn-primary" id="showcase-try-btn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                                    试试
                                </button>
                            </div>
                        </div>
                        <pre class="showcase-prompt-content" id="showcase-prompt-content"></pre>
                    </div>
                </div>
                <!-- Right: Preview Section -->
                <div class="showcase-preview-section">
                    <div class="showcase-preview-header">
                        <h3>交付物预览</h3>
                    </div>
                    <div class="showcase-preview-container" id="showcase-preview-container">
                        <div class="showcase-preview-placeholder">加载中...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container center-mode">
        <!-- Conversations Sidebar (Left) -->
        <div class="conversations-sidebar" id="conversations-sidebar">
            <div class="conversations-header">
                <button id="new-conversation-btn" class="new-conversation-entry" title="New Chat" aria-label="New Chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <rect x="3" y="3" width="18" height="18" rx="3" stroke="currentColor" stroke-width="1.8"/>
                        <path d="M14.8 7.6l1.6 1.6M10 16l-2.7.6.6-2.7 6.2-6.2 2.1 2.1L10 16z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    </svg>
                    <span class="new-conversation-text">New Chat</span>
                </button>
            </div>
            <!-- Workspace Panel -->
            <div class="workspace-panel">
                <div class="workspace-header" id="workspace-header">Workspace</div>
                <div class="workspace-list" id="workspace-list">
                    <div class="workspace-empty">No files yet. Generated files will appear here.</div>
                </div>
            </div>

            <!-- History quick entry -->
            <div class="sidebar-footer">
                <button id="history-toggle" class="history-toggle">History</button>
            </div>

            <!-- History overlay -->
            <div class="history-overlay" id="history-overlay">
                <div class="history-header">
                    <div>History</div>
                    <button id="history-close" class="history-close">✕</button>
                </div>
                <div class="conversations-list" id="conversations-list"></div>
            </div>
        </div>

        <!-- Splitter: Left <-> Middle -->
        <div class="v-splitter" id="splitter-left" title="拖拽调整宽度"></div>

        <!-- Chat Panel (Middle) -->
        <div class="chat-panel" id="chat-panel">
            <!-- Messages Area -->
            <div class="chat-messages" id="chat-messages">
                <!-- 消息将动态添加到这里 -->
            </div>

            <!-- Input Area -->
            <div class="chat-input-container">
                <!-- Welcome Message (shown when chat is empty) -->
                <div class="welcome-message" id="welcome-message" style="display:none;">
                    <div class="welcome-card">
                        <div class="welcome-header">
                            <span class="welcome-username" id="welcome-username">User</span>，你好！
                        </div>

                        <div class="capability-card">
                            <div class="capability-title">我能帮你做什么？</div>

                            <div class="capability-section">
                                <div class="capability-badge">复杂任务</div>
                                <div class="capability-content">
                                    <div class="capability-subtitle">一次搞定复杂需求</div>
                                    <div class="capability-examples">
                                        <div class="example">"分析Q3销售数据，生成带趋势图的PPT报告"</div>
                                        <div class="example">"写一份产品发布文案，配设计精美的宣传海报"</div>
                                    </div>
                                </div>
                            </div>

                            <div class="capability-section">
                                <div class="capability-badge">反复调教</div>
                                <div class="capability-content">
                                    <div class="capability-subtitle">不满意？继续提要求</div>
                                    <div class="capability-desc">改到满意为止，细节调整没问题</div>
                                </div>
                            </div>

                            <div class="capability-section">
                                <div class="capability-badge">多种格式</div>
                                <div class="capability-content">
                                    <div class="capability-subtitle">支持多种交付格式</div>
                                    <div class="capability-tags">
                                        <span class="tag">文档</span>
                                        <span class="tag">图片</span>
                                        <span class="tag">音频</span>
                                        <span class="tag">视频</span>
                                        <span class="tag">代码</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="welcome-cta">
                            <div class="cta-title">不知道做什么？试试下面的例子</div>
                        </div>
                    </div>
                </div>
                <!-- Input and Send Button -->
                <div class="input-row">
                    <div class="chat-input-box">
                        <textarea
                            id="chat-input"
                            class="chat-input has-addon"
                            placeholder="Message Wenning..."
                            rows="3"
                        ></textarea>
                        <div class="add-file-wrapper inside">
                            <input type="file" id="attach-input" multiple style="display:none" />
                            <button id="attach-btn" class="add-btn inside" type="button" aria-label="Attach Files">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <span class="tooltip" role="tooltip">Attach Files</span>
                        </div>
                        <div class="attachments-strip" id="attachments-strip"></div>
                    </div>
                    <button id="send-btn" class="send-btn">Send</button>
                    <button id="stop-btn" class="stop-btn" style="display:none" title="Stop Current Run">Stop</button>
                </div>
                <!-- Context Indicator -->
                <div class="context-indicator-bottom">
                    <span class="context-text" id="context-text">Context left until auto-compact: 100%</span>
                </div>
            </div>
        </div>

        <!-- Splitter: Middle <-> Right -->
        <div class="v-splitter" id="splitter-right" title="拖拽调整宽度"></div>

        <!-- Preview Panel (Right) -->
        <div class="preview-panel" id="preview-panel">

            <!-- File Tabs -->
            <div class="file-tabs-container" id="file-tabs-container">
                <!-- 文件列表标题栏 -->
                <div class="file-tabs-header">
                    <span class="file-tabs-title">Files</span>
                    <button class="file-list-collapse-btn" id="file-list-collapse-btn" title="折叠文件列表">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                </div>
                <ul class="file-tabs" id="file-tabs">
                    <!-- 文件标签动态生成 -->
                </ul>
            </div>

            <!-- Inner Splitter: File list <-> Content -->
            <div class="v-splitter" id="splitter-preview" title="拖拽调整文件列表宽度"></div>

            <!-- File Contents -->
            <div class="file-contents-container" id="file-contents-container">
                <!-- 展开按钮（折叠时显示） -->
                <button class="file-list-expand-btn" id="file-list-expand-btn" title="展开文件列表">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <div class="preview-content" id="preview-content">
                    <p class="preview-placeholder">Waiting for files...</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Auth Modal -->
    <div class="auth-overlay" id="auth-overlay" style="display:none;">
        <div class="auth-modal">
            <div class="auth-title">Sign In</div>
            <div class="auth-field">
                <label>Username</label>
                <input type="text" id="auth-username" placeholder="Enter username" />
            </div>
            <div class="auth-field">
                <label>Password</label>
                <input type="password" id="auth-password" placeholder="Enter password" />
            </div>
            <div class="auth-error" id="auth-error"></div>
            <div class="auth-actions">
                <button id="auth-login-btn" class="primary">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-overlay" id="feedback-overlay" style="display:none;">
        <div class="feedback-modal">
            <button class="feedback-close" id="feedback-close">✕</button>
            <div class="feedback-title">💬 用户反馈</div>
            <div class="feedback-subtitle">告诉我们您的需求和建议</div>

            <div class="feedback-field">
                <label>反馈类型 <span class="required">*</span></label>
                <select id="feedback-type">
                    <option value="">请选择...</option>
                    <option value="feature">功能需求</option>
                    <option value="bug">问题报告</option>
                    <option value="improvement">改进建议</option>
                    <option value="other">其他</option>
                </select>
            </div>

            <div class="feedback-field">
                <label>详细描述 <span class="required">*</span></label>
                <textarea id="feedback-content"
                          placeholder="请详细描述您的需求或遇到的问题..."
                          rows="6"></textarea>
            </div>

            <div class="feedback-field">
                <label>联系方式（可选）</label>
                <input type="text"
                       id="feedback-contact"
                       placeholder="邮箱或其他联系方式（以便我们跟进）" />
            </div>

            <div class="feedback-success" id="feedback-success" style="display:none;">
                ✓ 感谢您的反馈！我们会认真处理您的意见。
            </div>
            <div class="feedback-error" id="feedback-error" style="display:none;"></div>

            <div class="feedback-actions">
                <button id="feedback-submit-btn" class="primary">提交反馈</button>
                <button id="feedback-cancel-btn" class="secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- Markdown Renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- SheetJS for Excel Preview -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- docx-preview for Word Preview -->
    <script src="https://cdn.jsdelivr.net/npm/docx-preview@0.3.0/dist/docx-preview.min.js"></script>

    <!-- Driver.js for Product Tour (本地文件) -->
    <script src="/static/vendor/driver.iife.js"></script>

    <!-- Scripts -->
    <script src="/static/js/sse.js?v=20251229-insert-msg"></script>
    <script src="/static/js/ui.js?v=20260107-thinking-fix"></script>
    <script src="/static/js/showcase.js?v=20251229-insert-msg"></script>
    <script src="/static/js/tour.js?v=20251229-insert-msg"></script>
    <script src="/static/js/mention_autocomplete.js?v=20251229-insert-msg"></script>
    <script src="/static/js/app.js?v=20260108-auto-register"></script>
</body>
</html>
