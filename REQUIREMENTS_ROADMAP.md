# Wenning项目需求和任务路线图

> 生成日期：2025-12-19
> 最后更新：2025-12-19

## 📋 文档目的

本文档系统性地整理了Wenning项目的所有需求，并按照优先级、模块、类型进行分类，为后续开发提供清晰的路线图。

---

## 🎯 需求来源分析

### 1. Git历史分析（最近30次提交）
- **时间范围**：2025-12-19至今
- **主要开发方向**：
  - Claude/Bedrock API集成和稳定性修复
  - 前端用户体验优化
  - 监控和调试工具完善
  - 多模态能力扩展

### 2. 代码TODO/FIXME分析
- **识别数量**：1个技术债务
- **主要内容**：GPT-5 context window配置验证

### 3. 用户反馈分析
- **反馈数量**：0（尚无用户反馈记录）
- **反馈渠道**：需建立

### 4. 项目结构分析
- **已实现工具数量**：23个原子工具
- **核心能力**：多模态、工具组合、流式处理

---

## 📊 需求分类体系

### 按功能模块分类
```
1. LLM集成模块 (7项)
2. 工具系统 (5项)
3. 前端UI/UX (8项)
4. 监控和调试 (4项)
5. 配置和部署 (3项)
6. 测试和质量保证 (2项)
```

### 按优先级分类
```
P0 - 紧急（阻塞使用）: 0项
P1 - 高（重要功能）: 5项
P2 - 中（改进体验）: 12项
P3 - 低（锦上添花）: 11项
```

### 按类型分类
```
🐛 Bug修复: 1项
✨ 新功能: 8项
🔧 优化改进: 15项
📚 文档完善: 2项
🧪 测试增强: 2项
```

---

## 🗂️ 详细需求清单

### 一、LLM集成模块

#### 1.1 Claude/Bedrock API稳定性 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P0
- **类型**: 🐛 Bug修复
- **描述**:
  - 修复inf/nan值导致JSON序列化失败
  - 修复tool_result位置验证错误
  - 移除无效的fallback逻辑
- **完成时间**: 2025-12-19
- **相关Commit**:
  - `4e77918` - 修复inf值和消息清理
  - `a16182f` - 清理payload中的inf/nan值
  - `76c07f0` - 完善tool_result验证逻辑

#### 1.2 GPT-5 Context Window配置验证
- **状态**: 待处理
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**: 确认GPT-5的实际context window大小并更新配置
- **位置**: `src/agent/context_manager.py:TODO`
- **工作量**: 0.5天
- **前置条件**: 访问GPT-5官方文档或API规范

#### 1.3 Reasoning Effort参数优化 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**: 添加reasoning_effort参数提升思考模型质量
- **完成时间**: 2025-12-19
- **相关Commit**: `0b7043c`

#### 1.4 模型Thinking过程展示
- **状态**: 部分完成
- **优先级**: P2
- **类型**: ✨ 新功能
- **描述**:
  - ✅ 已实现：添加thinking调试日志
  - ❌ 未完成：GPT-5网关不暴露reasoning_content
- **限制**: 受网关限制，需网关侧支持
- **工作量**: 取决于网关团队

#### 1.5 多模型支持完善
- **状态**: 进行中
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**: 完善各模型的特性适配
  - ✅ 已支持：EB5、GPT-5、Claude、Gemini、DeepSeek、GLM、Doubao
  - ⚠️ 需优化：各模型的参数差异处理
- **工作量**: 2天

#### 1.6 LLM错误处理增强
- **状态**: 待处理
- **优先级**: P1
- **类型**: 🔧 优化改进
- **描述**:
  - 区分可重试错误和不可重试错误
  - 优化速率限制处理（429错误）
  - 添加断路器模式防止雪崩
- **工作量**: 1.5天

#### 1.7 流式响应稳定性优化
- **状态**: 待处理
- **优先级**: P1
- **类型**: 🔧 优化改进
- **描述**:
  - 处理网络抖动和连接中断
  - 优化SSE解析鲁棒性
  - 添加流式超时和心跳机制
- **工作量**: 1天

---

### 二、工具系统

#### 2.1 搜索API配额监控 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**:
  - 实现Tavily双账号自动切换
  - 添加使用统计和配额监控
  - 记录搜索历史到JSONL
- **完成时间**: 2025-12-19
- **相关Commit**:
  - `253ef7c` - Tavily双账号支持
  - `425da6c` - 启用统计功能
  - `e4601be` - 添加监控工具

#### 2.2 SVG栅格化支持 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P2
- **类型**: ✨ 新功能
- **描述**: 添加cairosvg依赖支持SVG到PNG转换
- **完成时间**: 2025-12-19
- **相关Commit**: `04b02eb`

#### 2.3 工具执行结果优化
- **状态**: 待处理
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**:
  - 优化长输出截断策略（避免信息丢失）
  - 添加结构化错误信息
  - 支持工具执行结果缓存
- **工作量**: 1天

#### 2.4 工具权限和安全控制
- **状态**: 待处理
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**:
  - 实现工具白名单/黑名单
  - 添加敏感操作二次确认
  - 限制文件系统访问范围
- **工作量**: 2天

#### 2.5 工具使用分析和推荐
- **状态**: 待处理
- **优先级**: P3
- **类型**: ✨ 新功能
- **描述**:
  - 统计各工具使用频率
  - 分析工具链模式
  - 智能推荐相关工具
- **工作量**: 2天

---

### 三、前端UI/UX

#### 3.1 文件列表折叠功能 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P2
- **类型**: ✨ 新功能
- **描述**: 实现文件列表的展开/折叠功能，优化大量文件时的显示
- **完成时间**: 2025-12-19
- **相关Commit**:
  - `6b63270` - 简化折叠功能
  - `62199b3` - 独立按钮实现
  - `ef85af3` - 增强按钮可见性

#### 3.2 对话加载优先级优化 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**: 优先加载有消息的最新对话
- **完成时间**: 2025-12-19
- **相关Commit**: `7e567fe`

#### 3.3 反馈按钮位置优化 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P2
- **类型**: 🐛 Bug修复
- **描述**: 修复反馈按钮位置，只在最终回复上显示
- **完成时间**: 2025-12-19
- **相关Commit**: `3fcc62f`

#### 3.4 引导功能触发时机优化 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P2
- **类型**: 🐛 Bug修复
- **描述**: 只在登录成功后自动触发引导
- **完成时间**: 2025-12-19
- **相关Commit**: `a5ead45`

#### 3.5 前端缓存和性能优化
- **状态**: 部分完成
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**:
  - ✅ 已实现：缓存版本控制
  - ⚠️ 需优化：大文件预览性能、图片lazy loading
- **工作量**: 1.5天

#### 3.6 移动端响应式适配
- **状态**: 待处理
- **优先级**: P3
- **类型**: ✨ 新功能
- **描述**:
  - 适配移动端屏幕尺寸
  - 优化触摸交互
  - 简化移动端布局
- **工作量**: 3天

#### 3.7 多媒体文件预览增强
- **状态**: 待处理
- **优先级**: P2
- **类型**: ✨ 新功能
- **描述**:
  - 支持更多视频格式
  - 添加音频波形可视化
  - 支持PDF内联预览
- **工作量**: 2天

#### 3.8 对话搜索和过滤
- **状态**: 待处理
- **优先级**: P3
- **类型**: ✨ 新功能
- **描述**:
  - 添加对话搜索功能
  - 支持按模型、时间过滤
  - 标签和分类管理
- **工作量**: 2天

---

### 四、监控和调试

#### 4.1 日志查看器 ✅ [已完成]
- **状态**: 已完成
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**:
  - 实现HTTP日志查看服务
  - 集成到Wenning UI
  - 支持搜索和过滤
- **完成时间**: 2025-12-19
- **相关Commit**:
  - `03d71ac` - 集成日志查看器
  - `a2df449` - 添加HTTP日志服务

#### 4.2 实时性能监控
- **状态**: 待处理
- **优先级**: P2
- **类型**: ✨ 新功能
- **描述**:
  - 监控API响应时间
  - 追踪工具执行耗时
  - 可视化性能瓶颈
- **工作量**: 2天

#### 4.3 错误追踪和告警
- **状态**: 待处理
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**:
  - 集成错误追踪服务（如Sentry）
  - 配置告警规则
  - 错误聚合和分析
- **工作量**: 1.5天

#### 4.4 调试工具增强
- **状态**: 待处理
- **优先级**: P3
- **类型**: 🔧 优化改进
- **描述**:
  - 添加消息历史可视化
  - 支持单步调试工具调用
  - 导出调试会话
- **工作量**: 2天

---

### 五、配置和部署

#### 5.1 配置文件验证
- **状态**: 待处理
- **优先级**: P2
- **类型**: 🔧 优化改进
- **描述**:
  - 添加.env配置验证工具
  - 提供配置模板和示例
  - 自动检测配置错误
- **工作量**: 1天

#### 5.2 Docker化部署
- **状态**: 待处理
- **优先级**: P1
- **类型**: ✨ 新功能
- **描述**:
  - 创建Dockerfile和docker-compose
  - 优化镜像大小
  - 配置健康检查
- **工作量**: 1.5天

#### 5.3 部署文档和CI/CD
- **状态**: 待处理
- **优先级**: P2
- **类型**: 📚 文档完善
- **描述**:
  - 编写部署指南
  - 配置GitHub Actions
  - 自动化测试和发布
- **工作量**: 2天

---

### 六、测试和质量保证

#### 6.1 单元测试覆盖率提升
- **状态**: 待处理
- **优先级**: P2
- **类型**: 🧪 测试增强
- **描述**:
  - 为核心模块添加单元测试
  - 目标覆盖率：70%+
  - 集成到CI流程
- **工作量**: 3天

#### 6.2 端到端测试
- **状态**: 待处理
- **优先级**: P3
- **类型**: 🧪 测试增强
- **描述**:
  - 使用Playwright编写E2E测试
  - 覆盖核心用户流程
  - 自动化回归测试
- **工作量**: 2天

---

## 🎯 优先级排序和执行路线

### 第一阶段：稳定性和核心功能（P0-P1）
**目标**：确保系统稳定可用
**时间**：1-2周

1. ✅ Claude API稳定性修复（已完成）
2. LLM错误处理增强
3. 流式响应稳定性优化
4. 工具权限和安全控制
5. 日志查看器（已完成）
6. 错误追踪和告警
7. Docker化部署

### 第二阶段：用户体验优化（P2）
**目标**：提升使用体验
**时间**：2-3周

1. ✅ 前端UX改进（大部分已完成）
2. GPT-5 Context配置验证
3. 多媒体文件预览增强
4. 工具执行结果优化
5. 前端缓存和性能优化
6. 实时性能监控
7. 配置文件验证
8. 部署文档和CI/CD
9. 单元测试覆盖率提升

### 第三阶段：增强功能（P3）
**目标**：锦上添花
**时间**：按需排期

1. 移动端响应式适配
2. 对话搜索和过滤
3. 工具使用分析和推荐
4. 调试工具增强
5. 端到端测试

---

## 📈 工作量估算

### 按优先级
- **P0（紧急）**: 0天（已完成）
- **P1（高优）**: 10天
- **P2（中优）**: 18天
- **P3（低优）**: 13天

### 按模块
- **LLM集成**: 5天
- **工具系统**: 7天
- **前端UI/UX**: 10.5天
- **监控调试**: 7.5天
- **配置部署**: 4.5天
- **测试QA**: 5天

**总计**: 约41天（约2个月工作量）

---

## 🔄 维护和更新

### 更新频率
- **每周**：更新任务状态，标记完成项
- **每月**：重新评估优先级，调整路线图
- **按需**：添加新需求，细化任务描述

### 维护规则
1. 已完成任务标记 ✅ 并注明完成时间
2. 新需求按照统一格式添加
3. 优先级可根据实际情况动态调整
4. 工作量估算仅供参考，实际执行时调整

---

## 📝 需求提交流程

1. **需求收集**：通过Git Issue、用户反馈、团队会议收集
2. **需求评审**：评估优先级、工作量、依赖关系
3. **需求录入**：更新到本文档
4. **任务分配**：分配到具体开发人员
5. **进度跟踪**：定期更��状态

---

## 📞 联系方式

- **文档维护者**: Wenning开发团队
- **反馈渠道**: GitHub Issues / 内部反馈表单
- **更新日志**: 见Git Commit历史

---

*本文档由Claude生成，基于项目Git历史、代码分析和对话记录综合整理。*
