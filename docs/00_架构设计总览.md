# 创作流 (CreativeFlow) Agent 架构设计总览

## 文档概述

本文档提供创作Agent的完整架构设计总览，整合**双层Agent架构**、工具设计、Workflow驱动、多模态扩展四个核心设计维度。

**核心架构特色**:
- 🎯 **Master Agent** 负责需求理解和工具调度
- 🔧 **Workflow Tools** 高集成度场景工具(如UGC分析、活动策划)
- ⚙️ **Atomic Tools** 基础原子能力(如Web抓取、Vision理解)
- 🔄 **灵活组合** 既支持一键调用复杂流程,也支持临时组合基础能力

---

## 1. 项目背景与定位

### 1.1 产品定位

**创作流 (CreativeFlow)**: 面向内容创作者的智能创作助手，专注于视觉内容生产全流程的自动化。

**核心价值主张**:
- 🎨 从创意到成品，一站式完成
- ⚡️ 自动化重复工作，提升10倍效率
- 🎯 智能理解需求，质量稳定可控

### 1.2 目标用户

| 用户画像 | 核心需求 | 使用频次 | 付费意愿 | 关键痛点 |
|---------|---------|---------|---------|---------|
| **知识类UP主** | 视频封面、配图、片头 | 日更 (7次/周) | 高 (¥99/月) | 设计耗时、审美不稳定 |
| **教育培训者** | PPT生成、课程素材 | 周更 (2-3次/周) | 中 (¥49/月) | 素材整理慢、排版重复 |
| **营销人员** | 海报、活动图、Banner | 项目制 (10次/月) | 高 (¥199/月) | 需求多变、交付压力大 |
| **产品运营** ⭐️新增 | UGC分析、活动文案、数据报告 | 日常 (5-10次/周) | 高 (¥199/月) | 批量处理耗时、内容策划灵感枯竭 |

**用户场景详解**:

**创作类用户** (UP主/教育者/营销):
- 核心诉求: **视觉内容生产自动化**
- 典型工作流: 创意构思 → 素材准备 → 设计制作 → 发布
- CreativeFlow价值: 10倍提效,保证质量稳定

**运营类用户** (产品运营):
- 核心诉求: **用户增长全链路效率提升** (推广→激活→留存→转介绍)
- 典型工作流: 用户调研 → 活动策划 → 内容制作 → 数据分析
- CreativeFlow价值: 释放重复劳动,聚焦策略决策

**MVP聚焦**: 知识类UP主的封面图生成场景

### 1.3 核心能力（底层工具）

**设计理念**: 提供可组合的原子能力，支撑多样化应用场景

```
┌─────────────────────────────────────────────┐
│         CreativeFlow 核心工具能力            │
├─────────────────────────────────────────────┤
│ 1. 图像处理与操作 💻                         │
│    - 图像合成与编辑（PIL/OpenCV代码）        │
│    - 裁剪/缩放/旋转/滤镜                     │
│    - 添加文字/水印/图层叠加                  │
│    - 批量处理                                │
├─────────────────────────────────────────────┤
│ 2. 多模态理解 🔧                             │
│    - 图像风格分析（Vision Service）          │
│    - 图像布局分析                            │
│    - 图像内容识别                            │
│    - 视频分析（帧提取/场景检测）             │
├─────────────────────────────────────────────┤
│ 3. AI生成（可选）🔧                          │
│    - AI图像生成（DALL-E/SD API调用）         │
│    - 复杂模板渲染（如需要）                  │
├─────────────────────────────────────────────┤
│ 4. 文本生成与处理 🤖/🔧                      │
│    - 结构化文本生成（LLM直接）               │
│    - 文本摘要（LLM直接）                     │
│    - 情感分析（工具封装）                    │
│    - 文本聚类（工具封装）                    │
├─────────────────────────────────────────────┤
│ 5. 数据处理与分析 💻                         │
│    - 统计分析（pandas代码）                  │
│    - 可视化（matplotlib代码）                │
│    - 趋势检测（代码实现）                    │
├─────────────────────────────────────────────┤
│ 6. 外部资源集成 🔧                           │
│    - 图库搜索与下载                          │
│    - Web内容抓取                             │
│    - API调用封装                             │
└─────────────────────────────────────────────┘

图例: 💻 = 主要通过LLM代码生成实现
     🔧 = 需要工具封装
     🤖 = LLM直接生成
```

---

## 1.4 双层Agent架构设计 ⭐️核心架构

### 架构理念

CreativeFlow采用**Master Agent + 双类型Tools**的分层架构,而非传统的单层Agent架构。

**核心设计思想**:
- ❌ **传统架构问题**: 单一LLM需要每次都从头组合基础工具,容易断链,用户体验差
- ✅ **CreativeFlow方案**: 将高频场景封装为**Workflow Tool**,低频需求动态组合**Atomic Tool**

### 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                CreativeFlow Master Agent                    │
│                                                             │
│  职责:                                                       │
│  1. 理解用户需求,识别场景类型                                │
│  2. 决策调用Workflow Tool还是组合Atomic Tool                │
│  3. 多轮对话管理与用户引导                                   │
│  4. 异常处理与人工介入判断                                   │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ 调度决策
                            ▼
        ┌───────────────────┴───────────────────┐
        │                                       │
        ▼                                       ▼
┌──────────────────────┐              ┌──────────────────────┐
│   Workflow Tools     │              │   Atomic Tools       │
│   (高集成度场景)      │              │   (基础原子能力)      │
├──────────────────────┤              ├──────────────────────┤
│                      │              │                      │
│ 🔧 UGC分析工作流     │              │ ⚙️ Web抓取           │
│   5步自动化流程      │              │                      │
│   ├─ 数据采集        │              │ ⚙️ Vision理解        │
│   ├─ 情感分析        │              │                      │
│   ├─ 主题聚类        │              │ ⚙️ 代码执行器        │
│   ├─ 内容筛选        │              │                      │
│   └─ 报告生成        │              │ ⚙️ 图库搜索          │
│                      │              │                      │
│ 🔧 活动策划工作流    │              │ ⚙️ 文档生成          │
│   5步自动化流程      │              │                      │
│   ├─ 选题调研        │              │                      │
│   ├─ 方案设计        │              └──────────────────────┘
│   ├─ PRD生成         │
│   ├─ 物料制作        │              特点:
│   └─ 传播策略        │              • 单一职责
│                      │              • 灵活组合
│ 🔧 数据报告工作流    │              • 可复用
│   自动化报告生成     │              • 快速响应
│                      │
└──────────────────────┘

特点:
• 端到端闭环
• 内部重试机制
• 进度透明反馈
• 用户体验简洁
```

### 工具分类策略

**何时设计为Workflow Tool?**

判断标准 (满足3项及以上):
1. ✅ 高频场景 (每周>5次)
2. ✅ 固定流程 (步骤相对稳定)
3. ✅ 多步协同 (需要3步以上工具组合)
4. ✅ 用户价值明确 (解决具体痛点)
5. ✅ 容错要求高 (中间失败需要重试)

**何时保持为Atomic Tool?**

判断标准:
1. ✅ 低频场景 (每月<3次)
2. ✅ 需求多变 (参数组合灵活)
3. ✅ 单一职责 (独立功能)

**当前工具清单对比**:

| 工具类型 | 工具名称 | 优先级 | 场景频次 | 设计原因 |
|---------|---------|--------|---------|---------|
| **Workflow** | UGC分析工作流 | P1 | 每周5-10次 | 运营核心场景,5步固定流程,价值明确 |
| **Workflow** | 活动策划工作流 | P1 | 每月3-5次 | 营销核心场景,端到端闭环,减少认知负担 |
| **Workflow** | 数据报告工作流 | P2 | 每周2-3次 | 可标准化,自动化价值高 |
| **Atomic** | Web抓取 | P0 | - | 基础能力,被Workflow调用 |
| **Atomic** | Vision理解 | P0 | - | 基础能力,被Workflow调用 |
| **Atomic** | 代码执行器 | P0 | - | 基础能力,被Workflow调用 |
| **Atomic** | 图库搜索 | P1 | 临时组合 | 需求灵活,不固定流程 |

### 调度决策逻辑

**Master Agent的决策树**:

```python
def route_user_request(user_input):
    """Master Agent的核心调度逻辑"""

    # 步骤1: 意图识别
    intent = analyze_user_intent(user_input)

    # 步骤2: 场景匹配
    if intent.matches_workflow("UGC分析"):
        # 直接调用集成工作流
        return {
            "tool": "ugc_analysis_workflow",
            "parameters": extract_params(user_input),
            "reason": "匹配预定义场景,一键执行"
        }

    elif intent.matches_workflow("活动策划"):
        return {
            "tool": "campaign_planning_workflow",
            "parameters": extract_params(user_input),
            "reason": "匹配预定义场景,一键执行"
        }

    else:
        # 动态组合基础工具
        required_tools = intent.decompose_to_atomic_tools()
        return {
            "execution_plan": [
                {"step": 1, "tool": "web_scraper", "params": {...}},
                {"step": 2, "tool": "vision_service", "params": {...}},
                {"step": 3, "tool": "code_executor", "params": {...}}
            ],
            "reason": "未匹配预定义场景,组合基础能力"
        }
```

**典型调用场景示例**:

**场景A: 用户需求精确匹配Workflow**

```
User: "帮我分析这个小红书活动的评论: [链接]"

Master Agent决策:
{
    "intent": "UGC内容分析",
    "matched_workflow": "ugc_analysis_workflow",
    "confidence": 0.95
}

执行:
→ 调用ugc_analysis_workflow
  → 内部自动执行5步
  → 返回Excel报告

用户体验: "一句话搞定,15分钟出结果"
```

**场景B: 用户需求需要组合Atomic Tools**

```
User: "帮我找竞品的设计风格,分析下配色方案"

Master Agent决策:
{
    "intent": "竞品设计分析",
    "matched_workflow": null,
    "atomic_tools_needed": ["web_scraper", "vision_service"]
}

执行:
→ 步骤1: 调用web_scraper抓取竞品网站图片
→ 步骤2: 调用vision_service分析风格和配色
→ 步骤3: LLM直接生成分析报告

用户体验: "灵活组合,满足临时需求"
```

**场景C: 用户中途调整Workflow执行**

```
User: "帮我分析评论"
→ Master Agent调用ugc_analysis_workflow
→ 执行到第3步(Good Case筛选)

User: "等等,筛选标准太严了,降低到70分"

Master Agent决策:
{
    "situation": "workflow_interrupted",
    "action": "adjust_params_and_resume"
}

执行:
→ 暂停workflow
→ 调整筛选阈值参数
→ 从第3步重新执行
→ 继续后续流程

用户体验: "支持人工介入,灵活可控"
```

### 架构优势分析

**对比传统单层Agent架构**:

| 维度 | 传统架构 | CreativeFlow双层架构 | 优势量化 |
|------|---------|---------------------|---------|
| **高频场景体验** | 每次5-6轮tool_call | 1次workflow调用 | **调用次数↓83%** |
| **失败容错** | 任一步失败→全链断 | Workflow内部重试 | **成功率↑40%** |
| **用户认知负担** | 需理解底层工具 | 自然语言描述场景 | **学习成本↓70%** |
| **开发维护成本** | 每次组合靠LLM推理 | 固化高频场景逻辑 | **质量稳定性↑50%** |
| **灵活性** | 理论上灵活 | Workflow+Atomic兼顾 | **实际灵活性持平** |

**对比纯Workflow架构(如n8n/Zapier)**:

| 维度 | 纯Workflow | CreativeFlow | 优势 |
|------|-----------|--------------|-----|
| **适应长尾需求** | ❌ 只能执行预定义 | ✅ 可临时组合Atomic | **覆盖率↑30%** |
| **开发成本** | 需为每个场景定义 | 渐进式(高频→Workflow) | **ROI更高** |
| **智能化** | 需用户选择workflow | Master Agent自动识别 | **体验更好** |

### 实施路线图

**V1.0 (MVP)**: 仅Atomic Tools
- 实现: Web抓取、Vision理解、代码执行器
- 验证: 基础能力可用性

**V1.5**: 引入第一批Workflow Tools
- 实现: UGC分析工作流、活动策划工作流
- 验证: 双层架构价值

**V2.0**: 完善工具矩阵
- 实现: 数据报告工作流、更多Atomic Tools
- 优化: Master Agent调度智能化

---

### 1.5 应用场景（工具组合）

**设计理念**: 基于核心工具的场景化封装，面向不同用户角色

```
┌─────────────────────────────────────────────┐
│        创作场景 (服务创作类用户)             │
├─────────────────────────────────────────────┤
│ • 视频封面生成  (P0 - MVP核心)              │
│   组合: 多模态理解 + 图库集成 + 视觉生成    │
│                                             │
│ • 批量图片处理  (P1 - V1.0)                │
│   组合: 视觉生成(批量模式)                  │
│                                             │
│ • PPT快速生成   (P1 - V1.0)                │
│   组合: 文本生成 + 图库集成 + 视觉生成      │
│                                             │
│ • 视频自动剪辑  (P2 - V2.0)                │
│   组合: 多模态理解(视频) + 文本生成(字幕)   │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│      运营场景 (服务运营类用户) ⭐️新增       │
├─────────────────────────────────────────────┤
│ • UGC内容分析   (P1 - V1.5)                │
│   组合: 文本处理(摘要/聚类/情感) +         │
│         文本生成(智能回复)                  │
│                                             │
│ • 活动策划      (P1 - V1.5)                │
│   组合: 文本生成(文案/方案) +              │
│         视觉生成(海报/物料) +               │
│         图库集成(素材)                      │
│                                             │
│ • 数据运营报告  (P2 - V2.0)                │
│   组合: 数据分析 + 文本生成(报告) +        │
│         数据可视化                          │
│                                             │
│ • 市场趋势洞察  (P2 - V2.0)                │
│   组合: Web抓取 + 文本处理(摘要) +         │
│         数据分析(趋势)                      │
└─────────────────────────────────────────────┘

场景间协同: 运营场景的"活动策划"可调用创作场景的"封面生成"
          (跨场景能力复用)
```

---

## 2. 运营场景深度应用 ⭐️新增

### 2.1 产品运营工作全景

基于产品运营人员的日常工作流程，CreativeFlow在以下环节提供AI辅助：

```
┌─────────────────────────────────────────────────────────────┐
│          产品运营工作流 (让用户来→用起来→持续用)             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  推广阶段                                                    │
│  ├─ 选题策划 → 活动设计 → 物料制作 → 渠道投放               │
│  └─ AI辅助: 热点分析 + 方案生成 + 视觉创作 + 文案优化       │
│                                                             │
│  激活/留存阶段                                               │
│  ├─ 用户调研 → 需求分析 → 产品优化 → 用户沟通               │
│  └─ AI辅助: UGC分析 + 反馈聚类 + 智能回复 + FAQ生成         │
│                                                             │
│  数据分析阶段                                                │
│  ├─ 指标监控 → 趋势分析 → 复盘报告 → 决策支持               │
│  └─ AI辅助: 自动化报告 + 可视化 + 异常检测 + 洞察提取       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 核心场景与痛点解决方案

基于《运营工作.md》中的真实痛点，CreativeFlow提供以下解决方案：

#### 场景1: UGC活动评审与用户建联

**典型案例**: "开学季晒体验赢4w奖池"活动，1000+条UGC内容需要人工筛选评比

**当前痛点**:
- 人工阅读1000条评论需5-10天
- 需要逐条判断质量、筛选good case
- 批量回复用户私信/评论，保持"有感情"的沟通
- 礼品发放和后续建联需手动记录跟踪
- 存在舆情风险需要及时发现负面情绪

**CreativeFlow解决方案**:

```
Workflow: UGC批量分析与处理

阶段1: 内容收集与清洗
  工具组合: Web抓取 + 结构化提取
  输入: 小红书/微博活动链接
  输出: 结构化数据(用户ID/评论内容/时间/互动数)

阶段2: 智能分析与分类
  工具组合: 文本处理(情感分析 + 主题聚类)
  执行:
    - 情感分类: 正面/中性/负面
    - 质量评分: 内容深度/真实性/传播价值
    - 主题聚类: 提取高频关键词和用户关注点
    - Good Case识别: 自动标记优质内容
  输出:
    - 分类结果(附信心分数)
    - 需人工复核的边界case列表
    - 舆情预警(负面情绪聚集)

阶段3: 批量回复生成
  工具组合: 文本生成(个性化回复)
  执行:
    - 基于用户内容生成定制化回复
    - 保持品牌tone & manner
    - 自动变化措辞避免"机器感"
  输出:
    - 待发送回复文本(支持人工微调)
    - 重点用户建联话术

阶段4: 数据整理与报告
  工具组合: 数据分析 + 文本生成
  输出:
    - 活动数据dashboard
    - 用户洞察报告(高频痛点/需求)
    - Good Case精选集(可用于后续传播)
```

**价值量化**:
- 时间节省: 5-10天 → 2小时 (90%+效率提升)
- 覆盖率提升: 人工筛选30% → AI辅助100%全量分析
- 质量保证: 情感分析避免遗漏负面舆情

---

#### 场景2: 活动策划与物料制作

**典型案例**: 节日营销活动从0到1(七夕/双十一/新年)

**当前痛点**:
- 选题灵感枯竭，重复策划类似活动
- 活动方案脑爆耗时，需要考虑用户行为路径
- PRD撰写、Brief编写重复劳动
- 图文视频素材制作需要找设计师协作
- 渠道投放策略依赖经验，缺乏数据支撑

**CreativeFlow解决方案**:

```
Workflow: 活动策划全流程

阶段1: 选题与灵感
  工具组合: Web抓取 + 文本处理(摘要)
  执行:
    - 抓取竞品近期活动(小红书/公众号/官网)
    - 热点话题追踪(微博热搜/知乎热榜)
    - 历史活动效果分析(ROI排序)
  输出: 选题推荐列表(附竞品案例和数据)

阶段2: 活动方案设计
  工具组合: 文本生成(结构化方案)
  输入:
    - 活动目标(拉新/促活/转化)
    - 用户画像
    - 预算范围
  执行:
    - 生成3-5个方案框架(目标/玩法/激励/传播)
    - 模拟用户行为路径
    - 预估数据指标
  输出:
    - 活动策划方案(Markdown格式)
    - 风险点与应对预案

阶段3: PRD与Brief生成
  工具组合: 文本生成
  输出:
    - 产品需求文档(功能/交互/验收标准)
    - 设计Brief(视觉风格/文案/素材需求)

阶段4: 物料制作
  工具组合: 视觉生成 + 文本生成
  执行:
    - 活动海报(调用封面生成能力)
    - 推送文案(标题/正文/CTA)
    - 教程图文/视频脚本
  输出:
    - 多尺寸海报(微信/微博/小红书)
    - 推送内容包(3-5个版本A/B测试)

阶段5: 传播策略建议
  工具组合: 数据分析 + 文本生成
  输入: 历史渠道数据
  输出:
    - 渠道预算分配建议
    - 投放时间表
    - 效果预估
```

**价值量化**:
- 策划耗时: 3-5天 → 1天 (70%效率提升)
- 方案质量: 提供竞品对标和数据支撑
- 物料交付: 无需等待设计师排期，2小时内出图

---

#### 场景3: 数据运营日报/周报

**当前痛点**:
- 需要从多个系统提取数据(后台/埋点/第三方)
- 重复劳动：每天/每周做相同的统计和整理
- 需要人工发现异常和趋势
- 写报告文字描述耗时

**CreativeFlow解决方案**:

```
Workflow: 自动化数据报告

阶段1: 数据采集
  工具组合: API集成 + 结构化提取
  执行:
    - 连接数据源(埋点平台/后台API)
    - 提取关键指标(DAU/留存/转化/流失)

阶段2: 数据分析
  工具组合: 数据分析(统计 + 趋势检测)
  执行:
    - 同比/环比计算
    - 异常检测(突增/突降)
    - 归因分析(关联事件/版本/活动)

阶段3: 报告生成
  工具组合: 文本生成 + 数据可视化
  输出:
    - 图表(折线图/柱状图/漏斗图)
    - 文字解读(数据变化原因分析)
    - 行动建议(针对异常的优化方向)

阶段4: 分发与归档
  执行:
    - 自动发送到企业微信/邮件
    - 历史报告归档(支持检索)
```

**价值量化**:
- 日报耗时: 30分钟 → 3分钟 (90%效率提升)
- 异常发现: 被动查看 → 主动预警
- 洞察深度: 基础统计 → 归因分析+行动建议

---

### 2.3 运营场景的工具组合模式

从上述3个核心场景可以看出，运营场景的特点是**工具组合调用**：

```
UGC分析场景 = Web抓取 + 文本处理(情感/聚类) + 文本生成(回复)
活动策划场景 = Web抓取 + 文本生成(方案/PRD) + 视觉生成(海报)
数据报告场景 = API集成 + 数据分析 + 文本生成(报告) + 可视化
```

这验证了我们的架构设计：
- **底层**: 提供可组合的工具能力
- **应用层**: 基于Workflow编排工具，解决场景化问题

---

### 2.4 完整工具能力矩阵

为了系统化地规划工具建设，我们绘制了完整的**场景×工具能力矩阵**：

| 工具能力 ↓ / 场景 → | 实现方式 | 封面生成 | PPT生成 | 视频剪辑 | UGC分析 | 活动策划 | 数据报告 | 趋势洞察 |
|-------------------|---------|---------|---------|---------|---------|---------|---------|---------|
| **图像处理与操作** | 💻 代码 | ⭐ | ⭐ | ⭐ | | ⭐ | | |
| └ 图像合成/编辑 | 💻 | ● | ● | ◐ | | ● | | |
| └ 裁剪/缩放/滤镜 | 💻 | ● | ● | ● | | ● | | |
| └ 添加文字/水印 | 💻 | ● | ● | | | ● | | |
| └ 批量处理 | 💻 | ◐ | ◐ | ◐ | | ● | | |
| **多模态理解** | 🔧 封装 | ⭐ | ◐ | ⭐ | | ◐ | | |
| └ 图像分析 | 🔧 | ● | ◐ | | | ◐ | | |
| └ 视频分析 | 🔧 | | | ● | | | | |
| **AI生成（可选）** | 🔧/API | ◐ | ◐ | | | ◐ | | |
| └ AI图像生成 | API | ◐ | ◐ | | | ◐ | | |
| └ 复杂模板渲染 | 🔧? | ◐ | ◐ | | | ◐ | | |
| **文本生成与处理** | 🤖 LLM | ◐ | ⭐ | ◐ | ⭐ | ⭐ | ⭐ | ⭐ |
| └ 结构化文本生成 | 🤖 | ◐ | ● | ◐ | ◐ | ● | ● | ● |
| └ 文本摘要 | 🤖 | | ◐ | | ● | ◐ | ◐ | ● |
| └ 情感分析 | 🤖 LLM | | | | ● | ◐ | ◐ | ◐ |
| └ 文本聚类/主题提取 | 🤖 LLM | | | | ● | ◐ | | ◐ |
| └ 智能改写 | 🤖 LLM | ◐ | ◐ | | ● | ● | | |
| └ 个性化生成 | 🤖 LLM | | | | ● | ● | | |
| └ 关键词提取 | 🤖/💻 | | | | ● | ◐ | | ● |
| **Web内容抓取** | 🔧 封装 | | | | ⭐ | ⭐ | | ⭐ |
| └ 社交媒体抓取 | 🔧 | | | | ● | ◐ | | ● |
| └ 竞品监控 | 🔧 | | | | | ● | | ● |
| └ 热点追踪 | 🔧 | | | | | ● | | ● |
| **数据分析** | 💻 代码 | | | | ⭐ | ◐ | ⭐ | ⭐ |
| └ 统计分析 | 💻 | | | | ● | ◐ | ● | ● |
| └ 趋势检测 | 💻 | | | | ● | | ● | ● |
| └ 异常识别 | 💻 | | | | ● | | ● | ◐ |
| └ 归因分析 | 💻 | | | | ◐ | ◐ | ● | ◐ |
| **数据可视化** | 💻 代码 | | | | ◐ | | ⭐ | ◐ |
| └ 图表生成 | 💻 | | | | ◐ | | ● | ◐ |
| └ Dashboard | 💻 | | | | | | ● | |
| └ (可选)固定模板 | 🔧 | | | | | | ◐ | |
| **外部资源集成** | 🔧 封装 | ⭐ | ◐ | ◐ | ◐ | ⭐ | ⭐ | ◐ |
| └ 图库API | 🔧 | ● | ◐ | | | ● | | |
| └ 数据平台API | 🔧 | | | | | | ● | |
| └ 企业应用集成 | 🔧 | | | | ◐ | ◐ | ● | |
| **结构化输出** | 💻 代码 | ◐ | ◐ | | ⭐ | ◐ | ⭐ | ◐ |
| └ Excel/CSV生成 | 💻 | | | | ● | | ● | |
| └ PDF报告（基础） | 💻 | | | | ◐ | ● | ● | ● |
| └ (可选)品牌模板 | 🔧 | | | | ◐ | ● | ● | ◐ |
| └ 文档格式转换 | 💻 | | ◐ | | ◐ | ● | ◐ | |

**图例说明**:
- ⭐ = 核心依赖（该场景的关键能力）
- ● = 强依赖（直接使用）
- ◐ = 弱依赖（辅助使用或可选）

**实现方式图例**:
- 🔧 **工具封装** - 需要开发专门的工具类（高频+复杂+需状态管理）
- 💻 **LLM代码生成** - LLM通过execute_python生成代码实现（需求多变+逻辑简单）
- 🤖 **LLM直接生成** - LLM直接输出结果，无需工具或代码（如文本摘要）

**关键洞察**:
1. **创作场景**（封面/PPT/视频）：
   - 💻 代码生成为主：图像处理（PIL/OpenCV）、批量操作
   - 🔧 工具封装（唯一）：多模态理解（Vision Service）
   - 🔧/API 可选：AI生图（如DALL-E）
2. **运营场景**（UGC/活动/数据/趋势）：
   - 🔧 工具封装（唯一）：Web抓取
   - 💻 代码生成：所有数据分析、可视化、Excel/PDF
   - 🤖 LLM直接：所有文本处理（生成/摘要/情感/聚类/关键词）
3. **跨场景协同**：活动策划 = 💻图像处理代码 + 🤖文本处理 + 💻数据分析
4. **工作量极致优化**：**仅需封装2类工具**，其他全部LLM自己做（15-22天 → 5-7天）

---

### 2.5 工具封装 vs 代码生成决策

基于**三层混合架构**（详见4.1节）的决策公式，我们对运营场景的能力进行分类：

#### 决策原则

```
封装价值 = 频率 × 质量影响 × 性能收益 - 开发维护成本

封装条件：
✅ 高频使用 + 质量关键 + 有性能优化空间
✅ 需要状态管理（如连接池、缓存、session）
✅ 需要专业领域知识（如反爬策略）
✅ LLM生成代码不稳定或质量差

代码生成条件：
✅ 需求变化大，难以统一封装
✅ 逻辑简单，LLM生成代码质量高
✅ pandas/numpy等库已经足够好用
✅ 灵活性 > 便利性
```

#### 运营场景能力分类

| 能力类别 | 实现方式 | 理由 | 优先级 |
|---------|---------|------|-------|
| **Web内容抓取** | ⭐️ 工具封装 | 反爬策略复杂、需维护代理池/session、平台API统一管理 | P0 |
| **多模态理解** | ⭐️ 工具封装 | Vision Service部署、模型加载、API封装 | P0(MVP已有) |
| **图像处理** | 💻 代码生成 | PIL/OpenCV代码简单、操作多变、LLM生成质量高 | - |
| **~~文本情感分析~~** | 🤖 LLM直接 | LLM本身擅长情感判断，无需额外模型 | - |
| **~~文本聚类~~** | 🤖/💻 LLM直接或代码 | LLM直接分析主题，或用embedding+简单代码 | - |
| **数据统计分析** | 💻 代码生成 | pandas已足够、需求多变、LLM生成质量高 | - |
| **趋势检测** | 💻 代码生成 | 算法简单、参数多变、几行pandas代码 | - |
| **异常识别** | 💻 代码生成 | 异常定义因场景而异、规则灵活 | - |
| **归因分析** | 💻 代码生成 | 每次逻辑不同、需结合业务判断 | - |
| **数据可视化** | 💻 代码生成为主 + ◐ 模板可选 | matplotlib/plotly代码简单、样式多变、可选封装2-3个高频模板 | P2(模板) |
| **文本摘要** | 🤖 LLM直接生成 | LLM本身擅长、无需额外工具 | - |
| **关键词提取** | 💻 代码生成 | jieba+TF-IDF几行代码、参数多变 | - |
| **Excel/PDF生成** | 💻 代码生成 + ◐ 模板可选 | openpyxl/reportlab代码简单、格式多变、可选封装品牌模板 | P2(模板) |

**核心结论**：
- ✅ **需要封装的工具（仅2类）**：
  1. **Web抓取**（运营场景） - 反爬复杂、需状态管理
  2. **多模态理解 / Vision Service**（创作场景，MVP已有） - 需部署视觉模型
- 💻 **交给LLM生成代码**：
  - 图像处理与操作（PIL/OpenCV）
  - 所有数据分析、可视化
  - Excel/PDF生成
  - PPT生成（python-pptx）
  - 关键词提取
- 🤖 **LLM直接处理**：
  - 所有文本生成、摘要、改写
  - 情感分析
  - 文本聚类/主题提取

**工作量极致优化**：从原计划的15-22天 → **仅需5-7天**（Web抓取工具开发）

---

### 2.6 工具能力建设优先级

基于上述决策，按版本规划工具建设：

#### **P0 - MVP阶段** (Week 1-4) - 封面生成
```
需要封装的工具：
🔧 多模态理解（Vision Service） - 需部署
🔧 图库API集成 - 需封装

无需封装（LLM代码生成）：
💻 图像处理（PIL/OpenCV代码）
💻 图像合成/编辑（代码实现）
🤖 文本生成（LLM直接）

工作量：约5-7天（主要是Vision Service部署）
```

#### **P1 - V1.0阶段** (Week 5-8) - PPT & 批量处理
```
无需新增工具：
💻 PPT生成（python-pptx代码）
💻 批量处理（Python循环代码）
🤖 文本生成（LLM直接）

工作量：0天（全部LLM代码生成）
```

#### **P2 - V1.5阶段** (Week 9-12) - 运营场景接入 ⭐️

**基于工具封装决策，实际需要封装的工具**：

| 工具类别 | 实现方式 | 技术选型 | 工作量 | 关键场景 |
|---------|---------|---------|-------|---------|
| **Web内容抓取** 🔧 | 工具封装 | Scrapy + Playwright | 5-7天 | UGC分析、活动策划、趋势洞察 |
| └ 小红书抓取 | 封装 | 反爬策略 + 代理池 | 2天 | UGC活动评审 |
| └ 微博抓取 | 封装 | API + 爬虫混合 | 2天 | 热点追踪 |
| └ B站抓取 | 封装 | 评论区API | 1天 | 用户反馈分析 |
| **~~文本分析套件~~** | 🤖 LLM直接 | LLM本身能力 | 0天 | UGC分析 |
| └ ~~情感分析~~ | 🤖 LLM直接 | LLM直接判断情感 | - | 舆情监控 |
| └ ~~文本聚类~~ | 🤖 LLM直接 | LLM提取主题 | - | 主题聚类 |
| └ ~~关键词提取~~ | 🤖 LLM直接 | LLM直接提取 | - | 热点发现 |
| **~~数据分析~~** | 💻 LLM生成 | pandas + numpy | - | 数据报告 |
| └ ~~统计分析~~ | 💻 LLM生成 | pandas代码 | - | - |
| └ ~~趋势检测~~ | 💻 LLM生成 | pandas代码 | - | - |
| └ ~~异常识别~~ | 💻 LLM生成 | 简单规则 | - | - |
| **~~数据可视化~~** | 💻 LLM生成为主 | matplotlib / plotly代码 | - | 数据报告 |
| └ (可选)常用模板 | 可选封装 | 2-3个固定格式 | 1-2天 | 日报/周报 |
| **~~结构化输出~~** | 💻 LLM生成 | openpyxl / reportlab代码 | - | UGC分析、数据报告 |
| └ ~~Excel生成~~ | 💻 LLM生成 | openpyxl (几行代码) | - | 数据导出 |
| └ ~~PDF报告~~ | 💻 LLM生成 | reportlab代码 | - | 正式报告 |
| └ (可选)品牌模板 | 可选封装 | 固定格式模板 | 1-2天 | 对外正式报告 |

**V1.5实际工作量**: **5-7天** (约1-1.5周)

**极致优化**：文本分析全部由LLM直接处理，再节省 2-3天

**工作量降低原因**：
- 数据分析类工具（统计/趋势/异常/归因）全部采用LLM代码生成，节省 5-7天
- 数据可视化主要用LLM代码生成，节省 2-3天
- 结构化输出（Excel/PDF）改为代码生成，节省 2天
- **文本分析（情感/聚类/关键词）全部LLM直接处理，节省 2-3天**

**效果保证**：
- LLM（如GPT-4/Claude）生成pandas/matplotlib代码质量已经很高
- LLM本身就擅长文本分析（情感/主题/关键词），无需额外工具
- 灵活性提升：每次需求不同，LLM直接处理最灵活
- 通过System Prompt规范，保证输出质量

#### **P3 - V2.0阶段** (Week 13+) - 高级能力

```
高级增强（可选）:
🔮 知识库与语义搜索（FAQ场景）- 5-7天
🔮 高级数据分析（归因/预测）- 7-10天
🔮 企业应用深度集成 - 5-7天
```

---

### 2.7 技术栈补充（运营场景）

基于工具封装决策，V1.5版本需要在`requirements.txt`中增加：

```python
# ============================================
# 运营场景依赖 (V1.5新增)
# ============================================

# ----------------
# 工具封装依赖 🔧
# ----------------

# Web抓取工具（唯一需要封装的运营工具）
scrapy>=2.11.0              # 爬虫框架
playwright>=1.40.0          # 浏览器自动化（反爬）
beautifulsoup4>=4.12.0      # HTML解析
requests>=2.31.0            # HTTP请求

# ----------------
# LLM代码生成环境 💻
# ----------------

# 数据分析库（LLM生成代码调用）
pandas>=2.0.0               # 数据处理
numpy>=1.24.0               # 数值计算
scipy>=1.11.0               # 科学计算（可选）

# 数据可视化库（LLM生成代码调用）
matplotlib>=3.7.0           # 基础绘图
plotly>=5.17.0              # 交互式图表（可选）

# 文本处理库（LLM生成代码调用，可选）
jieba>=0.42.0               # 中文分词（如需代码实现关键词提取）

# 结构化输出库（LLM生成代码调用）
openpyxl>=3.1.0             # Excel读写
reportlab>=4.0.0            # PDF生成
python-docx>=1.0.0          # Word文档（可选）
markdown>=3.5.0             # Markdown处理（可选）

# ============================================
# V2.0高级功能（可选）
# ============================================
# prophet>=1.1.0            # Facebook时间序列预测（LLM生成代码调用）
# statsmodels>=0.14.0       # 统计模型（LLM生成代码调用）
# faiss-cpu>=1.7.4          # 向量检索（工具封装）
```

**依赖说明**：
- 🔧 **工具封装依赖**（仅2类）：
  1. **Scrapy爬虫**（运营场景唯一需要封装的工具）
  2. **Vision Service**（创作场景，MVP已部署）
- 💻 **LLM代码生成环境**：
  - 图像处理：PIL、OpenCV
  - 数据分析：pandas、numpy
  - 可视化：matplotlib、plotly
  - 文档生成：openpyxl、reportlab、python-pptx
  - 文本处理：jieba（可选）
- 🤖 **LLM直接处理**（无需任何依赖）：
  - 所有文本生成、摘要、改写
  - 情感分析、主题聚类、关键词提取

**核心优势**：运营场景仅需开发1个工具（Web抓取），工作量**5-7天**

---

## 3. 整体架构设计

### 3.1 系统架构图

```
┌────────────────────────────────────────────────────────────────┐
│                        用户交互层                               │
│  CLI / Web UI / API                                            │
│  - 文字指令 + 文件上传 + 参数配置 + 实时反馈                    │
└────────────────────┬───────────────────────────────────────────┘
                     │
┌────────────────────▼───────────────────────────────────────────┐
│                   LLM Agent 核心                                │
│ ┌────────────────────────────────────────────────────────────┐ │
│ │  System Prompt (5层结构)                                   │ │
│ │  ├─ Layer 1: 身份与能力定义                                │ │
│ │  ├─ Layer 2: 工具列表与使用说明                            │ │
│ │  ├─ Layer 3: 场景化Workflow (核心) ⭐️                     │ │
│ │  ├─ Layer 4: 质量标准与验证规则                            │ │
│ │  └─ Layer 5: 约束与原则                                    │ │
│ └────────────────────────────────────────────────────────────┘ │
│                          ↓                                      │
│              Function Calling (工具调用)                        │
│                          ↓                                      │
└──────────────────────────┬─────────────────────────────────────┘
                           │
        ┌──────────────────┴──────────────────┐
        │                                     │
┌───────▼──────────────┐          ┌─────────▼──────────────┐
│   工具层 (封装)       │          │   工具层 (灵活)        │
├──────────────────────┤          ├────────────────────────┤
│ 第二层: 组合工具      │          │ execute_python         │
│ - compose_cover      │          │ - PIL/OpenCV/ffmpeg   │
│ - batch_process      │          │ - python-pptx         │
│ - create_ppt         │          │                       │
│                      │          │ run_shell              │
│ 第一层: 原子工具      │          │ - curl/wget           │
│ - resize_image       │          │ - git                 │
│ - add_text           │          │ - 任意命令             │
│ - apply_filter       │          │                       │
│                      │          │                       │
│ Vision工具:           │          │                       │
│ - analyze_image      │          │                       │
│ - analyze_video      │          │                       │
└──────────┬───────────┘          └────────┬──────────────┘
           │                               │
    ┌──────▼───────────────────────────────▼─────────────┐
    │           底层服务与资源层                          │
    ├────────────────────────────────────────────────────┤
    │ • Vision Service (FastAPI)                         │
    │   - CLIP (风格分类)                                │
    │   - YOLOv8 (目标检测)                              │
    │   - BLIP-2 (图像描述)                              │
    │   - EasyOCR (文字识别)                             │
    │                                                    │
    │ • 外部API集成                                       │
    │   - 图库API (Unsplash/Pexels)                      │
    │   - AI生成API (DALL-E/SD) [可选]                   │
    │   - 多模态LLM (GPT-4V) [按需]                      │
    │                                                    │
    │ • 模板与资源                                        │
    │   - 封面模板库 (templates/covers/)                 │
    │   - PPT模板库 (templates/ppts/)                    │
    │   - 字体/配色方案                                   │
    │   - 用户素材库 (user_assets/)                      │
    └────────────────────────────────────────────────────┘
```

### 3.2 数据流示例: 封面生成全流程

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 用户输入                                                  │
│    "帮我生成视频封面，标题'AI改变世界'，要科技风"             │
│    + 上传 reference.jpg                                      │
└────────────┬────────────────────────────────────────────────┘
             │
┌────────────▼────────────────────────────────────────────────┐
│ 2. Agent 接收多模态消息                                      │
│    messages = [{                                            │
│      "role": "user",                                        │
│      "content": "帮我生成封面...",                           │
│      "attachments": ["reference.jpg"]                       │
│    }]                                                       │
└────────────┬────────────────────────────────────────────────┘
             │
┌────────────▼────────────────────────────────────────────────┐
│ 3. Workflow驱动执行 (封面生成6阶段)                          │
│                                                             │
│ 阶段1: 需求分析 ✓                                           │
│   → 提取关键词: ["AI", "科技", "未来"]                       │
│   → 创建plan.md                                             │
│                                                             │
│ 阶段2: 素材准备                                              │
│   → analyze_image(reference.jpg, "style")                  │
│   ← {"style_tags": ["科技","蓝色调"], ...}                   │
│   → search_stock_images("AI technology")                   │
│   ← [{"url": "...", "id": "img1"}, ...]                    │
│   → download_file("...", "assets/bg1.jpg")                 │
│   → analyze_image("assets/bg1.jpg", "layout")              │
│   ← {"main_subject_bbox": [...], "safe_text_regions": [...]}│
│                                                             │
│ 阶段3: 模板匹配                                              │
│   → match_cover_template("AI改变世界", "科技", "bilibili")   │
│   ← {"recommended": ["tech_minimal", "tech_gradient"]}     │
│                                                             │
│ 阶段4: 封面生成                                              │
│   → compose_cover(                                          │
│       template="tech_minimal",                              │
│       title="AI改变世界",                                    │
│       background="assets/bg1.jpg",                          │
│       style_overrides={}                                    │
│     )                                                       │
│   ← {"variants": ["v1.jpg", "v2.jpg", "v3.jpg"]}           │
│                                                             │
│ 阶段5: 质量检查                                              │
│   → quality_check("v1.jpg")                                 │
│   ← {"passed": true, "score": 8.5}                         │
│   → generate_preview_html([v1, v2, v3])                    │
│                                                             │
│ 阶段6: 用户确认                                              │
│   ← Agent展示3个候选,推荐v1                                   │
│   → 用户反馈: "标题改成白色,大一点"                           │
│   → adjust_cover("v1.jpg", {"title_color": "#FFF", ...})   │
│   ← 生成最终版本                                             │
└────────────┬────────────────────────────────────────────────┘
             │
┌────────────▼────────────────────────────────────────────────┐
│ 4. 交付物输出                                                │
│    workspace/                                               │
│      plan.md                                                │
│      assets/backgrounds/bg1.jpg                             │
│      covers/                                                │
│        cover_v1.jpg                                         │
│        cover_v2.jpg                                         │
│        cover_v3.jpg                                         │
│        cover_final.jpg  ← 用户确认版本                       │
│      preview.html                                           │
│      metadata.json                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 三大核心设计

### 4.1 工具封装 vs 代码生成 (三层混合架构)

**设计理念**: 不是二选一,而是分层共存

```
┌─────────────────────────────────────────────┐
│ 第三层: 代码生成 (长尾需求)                  │
│ execute_python(code)                        │
│ - 特殊效果 (手绘风格转换)                    │
│ - 实验性功能                                 │
│ - 快速验证                                   │
└────────────────┬────────────────────────────┘
                 │ 调用
┌────────────────▼────────────────────────────┐
│ 第二层: 组合工具 (业务场景)                  │
│ - compose_cover(template, ...)              │
│ - batch_process_images(dir, ops)            │
│ - create_ppt_from_outline(outline)          │
└────────────────┬────────────────────────────┘
                 │ 组合调用
┌────────────────▼────────────────────────────┐
│ 第一层: 原子工具 (高频操作)                  │
│ - resize_image(path, size, mode)            │
│ - add_text_to_image(img, text, ...)         │
│ - apply_image_filter(img, filter)           │
└─────────────────────────────────────────────┘
```

**决策公式**:
```python
封装价值 = 频率 × 质量影响 × 性能收益 - 开发维护成本

if 封装价值 > 阈值:
    封装为工具
else:
    使用代码生成
```

**实施路径**:
- MVP: 5个核心工具 + execute_python兜底
- V1.0: 10-15个工具 + 代码生成(30%)
- V2.0: 完善工具体系 + 自动工具生成

**详细文档**: [01_工具封装vs代码生成架构决策.md](./01_工具封装vs代码生成架构决策.md)

---

### 4.2 Workflow驱动的System Prompt

**设计理念**: Workflow = 领域专家的操作手册

**传统Agent问题**:
```python
system_prompt = "你是创作助手,帮用户生成封面"
# 问题: 每次重新思考 → 不稳定、易遗漏、依赖模型能力
```

**Workflow驱动改进**:
```python
system_prompt = """
当用户请求生成封面时,严格按以下6阶段执行:

阶段1: 需求分析
  目标: 明确设计方向
  执行: 收集标题/风格/平台, 提取关键词
  验证点: plan.md已创建, 信息完整

阶段2: 素材准备
  目标: 获取高质量背景
  执行: 策略A(参考图分析) → B(图库搜索) → C(AI生成)
  验证点: ≥1张图, 分辨率>=1920x1080

... (详细6阶段)

每阶段必须验证通过才能继续
失败时执行备选方案,不死磕
"""
```

**Workflow结构**:
- ✅ 显式状态机 (阶段1→2→3...)
- ✅ 决策树嵌入 (if-else逻辑)
- ✅ 质量门禁 (验证点)
- ✅ 失败降级 (备选方案链)

**核心优势**:
1. 执行路径固定 → 质量稳定
2. 步骤完整 → 不遗漏关键环节
3. 有验证点 → 错误早发现
4. 中等模型也能用 → 降低成本

**详细文档**: [02_Workflow驱动的System_Prompt设计.md](./02_Workflow驱动的System_Prompt设计.md)

---

### 4.3 多模态扩展方案

**核心问题**: Agent需要"看到"用户上传的图片/视频

**三种方案对比**:

| 方案 | 成本 | 延迟 | 精度 | 推荐场景 |
|------|------|------|------|---------|
| A: 多模态LLM | ❌高($0.01/图) | ❌3-10秒 | ✅最高 | 高端产品 |
| B: Vision工具 | ✅低(免费) | ✅1-2秒 | ⚠️中等 | ⭐️MVP |
| C: 混合方案 | ⚠️中 | ⚠️1-10秒 | ✅高 | ⭐️V1.0+ |

**推荐方案: B + C (Vision工具为主, 按需调用多模态LLM)**

**Vision工具体系**:
```python
# 风格分析
analyze_image_style(img) → {
    "style_tags": ["科技", "简约"],
    "dominant_colors": ["#2E5090", "#FFF"],
    "recommended_template": "tech_minimal"
}

# 布局分析
analyze_image_layout(img) → {
    "main_subject_bbox": [200, 100, 800, 600],
    "safe_text_regions": [...],  # 可放文字的区域
    "face_locations": [...]  # 人脸位置(避免遮挡)
}

# 内容识别
analyze_image_content(img) → {
    "objects": ["laptop", "coffee"],
    "scene": "office",
    "tags": ["工作", "科技"]
}
```

**实现方案**:
```
Vision Service (FastAPI)
├─ CLIP (风格分类) - 开源免费
├─ YOLOv8 (目标检测) - 开源免费
├─ BLIP-2 (图像描述) - 开源免费
└─ EasyOCR (文字识别) - 开源免费

部署成本: GPU服务器(RTX 3060) ¥15,000 一次性
运营成本: 几乎为0 (电费可忽略)
```

**成本对比**:
- 纯GPT-4V: $300/月 (1000张/天)
- 本地Vision: ¥0/月 (无限量)
- 混合(80%本地+20%GPT-4V): $60/月

**详细文档**: [03_多模态扩展方案设计.md](./03_多模态扩展方案设计.md)

---

## 5. MVP实施计划

### 5.1 MVP范围定义

**核心场景**: 知识类UP主的视频封面生成

**用户故事**:
```
作为一个B站知识区UP主,
我希望用自然语言描述需求(标题+风格),
或上传参考图,
就能在2分钟内得到3-5个高质量封面候选,
这样我就不用花1小时在PS上做设计了。
```

**成功指标**:
- 生成成功率 > 90%
- 用户满意度 > 4分(5分制)
- 平均生成时间 < 2分钟
- 用户复用率(一周内再次使用) > 50%

### 5.2 MVP功能清单

| 功能模块 | 优先级 | 预估工时 | 依赖 |
|---------|-------|---------|------|
| **核心流程** | | | |
| 封面生成Workflow(6阶段) | P0 | 2天 | - |
| 模板系统(5个模板) | P0 | 3天 | - |
| 质量检查与验证 | P0 | 1天 | - |
| **工具层** | | | |
| 原子工具(resize/add_text/filter) | P0 | 2天 | PIL/Pillow |
| 组合工具(compose_cover) | P0 | 2天 | 原子工具 |
| 代码生成(execute_python) | P0 | 0.5天 | 复用现有 |
| **Vision能力** | | | |
| Vision Service部署 | P0 | 2天 | CLIP/YOLOv8 |
| analyze_style工具 | P0 | 1天 | Vision Service |
| analyze_layout工具 | P0 | 1天 | Vision Service |
| **素材集成** | | | |
| Unsplash API集成 | P0 | 1天 | - |
| 本地素材库管理 | P1 | 1天 | - |
| **用户体验** | | | |
| CLI交互界面 | P0 | 1天 | - |
| 预览HTML生成 | P0 | 0.5天 | - |
| 进度反馈优化 | P1 | 0.5天 | - |

**总工时**: 17.5天 (约3-4周,包含测试和调优)

### 5.3 MVP开发时间线

**Week 1: 基础设施**
- Day 1-2: 部署Vision Service, 实现2个核心API
- Day 3-4: 实现原子工具(resize/add_text)
- Day 5: 集成Unsplash API

**Week 2: 核心功能**
- Day 1-3: 实现compose_cover组合工具
- Day 4-5: 创建5个封面模板

**Week 3: Workflow集成**
- Day 1-3: 编写封面生成Workflow完整Prompt
- Day 4-5: 集成到Agent, 端到端测试

**Week 4: 测试与优化**
- Day 1-2: 真实用户测试(10-20个任务)
- Day 3-4: 修复bug, 优化体验
- Day 5: 准备V1.0规划

---

## 6. 技术栈选型

### 6.1 核心技术栈

```yaml
LLM Agent:
  - 框架: 基于icon_collection_agent改造
  - 模型: EB_SPV4 (或其他支持Function Calling的模型)
  - 编排: Function Calling + Workflow Prompt

Vision Service:
  - 框架: FastAPI
  - 风格分类: CLIP (openai/clip-vit-base-patch32)
  - 目标检测: YOLOv8 (ultralytics)
  - 图像描述: BLIP-2 (Salesforce/blip2-opt-2.7b)
  - 文字识别: EasyOCR
  - 人脸检测: Mediapipe

图像处理:
  - 基础: PIL/Pillow
  - 高级: OpenCV (布局分析/智能裁剪)
  - 滤镜: ImageFilter + 自定义算法

外部API:
  - 图库: Unsplash API (免费5000次/小时)
  - 备选图库: Pexels API
  - AI生成(可选): Replicate (多种模型)

模板系统:
  - 格式: JSON配置文件
  - 存储: templates/covers/
  - 版本管理: Git

开发语言:
  - 后端: Python 3.10+
  - 前端(预览): HTML + Tailwind CSS

部署:
  - Agent: Docker容器
  - Vision Service: Docker + GPU
  - 存储: 本地文件系统 (MVP阶段)
```

### 6.2 依赖库清单

```txt
# requirements.txt (MVP核心依赖)

# LLM & Agent
requests>=2.31.0
openai>=1.0.0  # OpenAI SDK (兼容多种API)

# 图像处理
Pillow>=10.0.0
opencv-python>=4.8.0

# Vision模型
torch>=2.0.0
torchvision>=0.15.0
transformers>=4.30.0
ultralytics>=8.0.0  # YOLOv8
easyocr>=1.7.0
mediapipe>=0.10.0

# Vision Service
fastapi>=0.100.0
uvicorn>=0.23.0
python-multipart>=0.0.6

# 工具库
numpy>=1.24.0
scikit-learn>=1.3.0  # K-means聚类(提取主色调)

# 视频处理(V1.0可选)
# ffmpeg-python>=0.2.0
# whisper>=1.0.0

# PPT生成(V1.0可选)
# python-pptx>=0.6.21
```

---

## 7. 质量保证策略

### 7.1 测试策略

**单元测试**:
```python
# 测试原子工具
def test_resize_image():
    img = resize_image("test.jpg", 1920, 1080, mode="cover")
    assert img.size == (1920, 1080)

# 测试Vision工具
def test_analyze_style():
    result = analyze_image_style("test_tech.jpg")
    assert "科技" in result['style_tags']
```

**集成测试**:
```python
# 测试完整Workflow
def test_cover_generation_workflow():
    agent = CreativeAgent()
    result = agent.run("生成封面: AI改变世界")
    assert result['success'] == True
    assert len(result['variants']) >= 3
    assert all(Path(v).exists() for v in result['variants'])
```

**用户测试**:
- 招募10-20个真实UP主
- 提供20个真实标题
- 记录成功率、耗时、满意度

### 7.2 监控指标

```python
# 关键指标监控
metrics = {
    # 功能指标
    "generation_success_rate": "> 90%",
    "avg_generation_time": "< 120s",
    "quality_check_pass_rate": "> 95%",

    # 用户体验
    "user_satisfaction": "> 4.0/5",
    "retry_rate": "< 20%",
    "iteration_count": "< 2次/任务",

    # 成本指标
    "tool_usage_ratio": "> 60%",  # 工具 vs 代码生成
    "api_cost_per_task": "< $0.1",

    # 性能指标
    "vision_api_latency": "< 2s",
    "llm_api_latency": "< 5s",
    "total_latency_p95": "< 150s"
}
```

### 7.3 质量标准

**封面图交付标准**:
```yaml
技术要求:
  - 分辨率: >= 1920x1080
  - 文件大小: < 2MB
  - 格式: JPG/PNG
  - 文字对比度: >= 4.5

视觉质量:
  - 构图: 遵循三分法或对称
  - 配色: 主色≤3种
  - 字体: 中文优先思源/方正
  - 层次: 主标题>副标题>装饰

内容要求:
  - 标题完整显示无截断
  - 人脸(如有)不被遮挡
  - 符合平台规范
```

---

## 8. 成本估算

### 8.1 开发成本

| 项目 | 金额 | 说明 |
|------|------|------|
| **硬件** | | |
| GPU服务器(RTX 3060) | ¥15,000 | 一次性,本地部署Vision Service |
| 或云GPU租用 | ¥1,440/月 | T4 GPU, ¥2/小时×720小时 |
| **软件/服务** | | |
| Unsplash API | ¥0 | 免费5000次/小时 |
| 域名+服务器(Web版) | ¥500/年 | 可选,MVP不需要 |
| **人力** | | |
| 开发工时(3-4周) | ¥20,000 | 按项目制 |

**总计(本地部署)**: ¥35,000 + 人力

### 8.2 运营成本 (1000用户/月)

假设: 每用户平均生成10个封面/月

| 项目 | 方案A (纯GPT-4V) | 方案B (纯本地) | 方案C (混合) |
|------|-----------------|--------------|-------------|
| Vision分析 | $100 (10K图) | ¥0 | ¥0 |
| LLM推理 | $50 | $50 | $50 |
| 图库API | ¥0 | ¥0 | ¥0 |
| 服务器 | ¥500 | ¥500 + 电费 | ¥500 |
| **月总成本** | **$150 (¥1,080)** | **¥500** | **¥850** |
| **成本/用户** | **¥1.08** | **¥0.5** | **¥0.85** |

**结论**: 方案B (纯本地) 成本最低, 规模化后优势明显

---

## 9. 风险与应对

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| **Vision工具精度不足** | 中 | 高 | 引入多模态LLM兜底 (方案C) |
| **模板不符合用户审美** | 高 | 中 | 快速迭代模板, A/B测试 |
| **生成速度慢影响体验** | 中 | 高 | 优化模型(量化), 增加GPU |
| **Unsplash限流** | 低 | 中 | 接入多个图库(Pexels备选) |
| **用户需求差异大** | 高 | 中 | 提供自定义模板上传功能 |
| **EBSPV4模型能力不足** | 中 | 高 | 测试其他模型(Claude/GPT-4) |
| **GPU服务器故障** | 低 | 高 | 云GPU备份 + 监控告警 |

---

## 10. 扩展路线图

### MVP (Week 1-4): 封面生成

**目标**: 验证核心价值, 获取首批用户

**功能**:
- ✅ 封面生成Workflow (6阶段)
- ✅ 5个模板 (科技/文艺/商务/娱乐/通用)
- ✅ Vision工具 (风格+布局分析)
- ✅ Unsplash图库集成

**交付**:
- CLI工具
- 本地运行

---

### V1.0 (Week 5-8): 功能扩展

**目标**: 扩展到批量处理和PPT生成

**新增功能**:
- 批量图片处理Workflow
- PPT生成Workflow (基础)
- 混合Vision方案 (80%本地 + 20%GPT-4V)
- 用户素材库管理

**优化**:
- 模板库扩展到15个
- 性能优化 (缓存/并发)
- Web UI (可选)

---

### V1.5 (Week 9-12): 运营场景接入 ⭐️

**目标**: 扩展到运营用户，验证跨场景价值

**新增功能**:
- **UGC内容分析** (核心)
  - 批量评论抓取与结构化
  - 情感分析 + 主题聚类
  - 智能回复生成
- **活动策划助手** (核心)
  - 选题推荐 + 方案生成
  - PRD/Brief自动生成
  - 结合封面生成能力产出物料
- 历史任务管理 (查看/复用)
- 多平台适配 (抖音/YouTube/小红书尺寸)

**技术增强**:
- Web抓取能力(支持主流平台)
- 文本聚类与情感分析模块
- 数据可视化组件(基础)

---

### V2.0 (Week 13+): 完整产品生态

**目标**: 构建完整创作+运营工作流，实现商业化

**新增功能**:
- **数据运营报告** (运营场景)
  - 自动化日/周/月报
  - 趋势分析 + 异常检测
  - 归因分析 + 行动建议
- **市场趋势洞察** (运营场景)
  - 多平台舆情聚合
  - 竞品动态追踪
- 视频剪辑Workflow (创作场景)
- 跨场景流程编排
  - 运营: UGC分析 → 需求洞察 → 活动策划 → 物料制作 → 数据复盘
  - 创作: 封面→配图→PPT→视频
- 团队协作功能
- API开放平台

**商业化**:
- 免费版: 10次/月
- 基础版: ¥49/月 (创作用户), 100次/月
- 专业版: ¥199/月 (运营用户), 无限次 + 高级功能 + 数据分析

---

## 11. 文档导航

### 核心设计文档

1. **[工具封装vs代码生成架构决策](./01_工具封装vs代码生成架构决策.md)**
   - 三层混合架构设计
   - 决策原则与迁移策略
   - MVP实施建议

2. **[Workflow驱动的System Prompt设计](./02_Workflow驱动的System_Prompt设计.md)**
   - 5层System Prompt结构
   - 完整的封面生成Workflow示例
   - Workflow编写规范与模板

3. **[多模态扩展方案设计](./03_多模态扩展方案设计.md)**
   - 三种方案对比分析
   - Vision工具体系详细设计
   - 实现细节与成本分析

### 参考资料

- icon_collection_agent源码: `../llm_agent.py`
- 模板示例目录: `../templates/` (待创建)
- 测试用例目录: `../tests/` (待创建)

---

## 12. 快速开始

### 开发环境搭建

```bash
# 1. 克隆项目
cd /path/to/universal_scenario_framework/tmp_scenarios/
mkdir creative_agent && cd creative_agent

# 2. 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 部署Vision Service
cd vision_service
python deploy.py  # 下载模型并启动服务

# 5. 配置环境变量
cp .env.example .env
# 编辑.env, 填入API keys

# 6. 运行MVP Demo
python creative_agent.py "生成封面: AI改变世界, 科技风"
```

### MVP Demo使用示例

```bash
# 示例1: 纯文本输入
python creative_agent.py "生成B站视频封面，标题'10分钟学会Python'，教程风格"

# 示例2: 上传参考图
python creative_agent.py --reference ref.jpg "按这个风格生成封面，标题'AI时代'"

# 示例3: 交互式模式
python creative_agent.py --interactive
> 帮我生成封面
> 标题: AI改变世界
> 风格: 科技
> [Agent执行...]
> 生成了3个版本，选择版本1
> 标题改成白色，大一点
> [调整完成]
```

---

## 13. 总结

### 核心设计原则

1. **工具设计**: 三层混合(原子工具+组合工具+代码生成)
2. **Workflow驱动**: 固化最佳实践, 保证质量稳定
3. **多模态扩展**: Vision工具为主, 按需调用高精度模型

### 关键优势

- ✅ **成本可控**: 本地Vision免费, 规模化成本优势明显
- ✅ **质量稳定**: Workflow固化流程, 验证点保证质量
- ✅ **快速迭代**: MVP 3-4周交付, 快速验证需求
- ✅ **易扩展**: 工具化架构, 新场景快速接入

### 实施建议

**MVP阶段** (Week 1-4):
- 聚焦封面生成单一场景
- 5个核心工具 + Vision Service
- 本地CLI工具交付

**验证指标**:
- 成功率 > 90%
- 满意度 > 4/5
- 复用率 > 50%

**达标后进入V1.0, 扩展功能和用户量**

---

**文档版本**: v1.0
**最后更新**: 2025-11-10
**维护团队**: CreativeFlow架构组
**审核状态**: ✅ 已审核

---

## 附录

### A. 相关链接

- [CLIP模型](https://github.com/openai/CLIP)
- [YOLOv8](https://github.com/ultralytics/ultralytics)
- [BLIP-2](https://github.com/salesforce/LAVIS)
- [Unsplash API](https://unsplash.com/developers)
- [FastAPI](https://fastapi.tiangolo.com/)

### B. 常见问题

**Q: 为什么不直接用GPT-4V?**
A: 成本高($0.01/图), 规模化后不可承受。本地Vision成本几乎为0。

**Q: 中等模型能跑通Workflow吗?**
A: 可以。Workflow固化了流程, 降低了对模型推理能力的要求。

**Q: MVP需要多少GPU显存?**
A: 12GB (RTX 3060) 足够运行CLIP+YOLOv8。更大模型需24GB+。

**Q: 能离线运行吗?**
A: Vision部分可以离线, 但图库搜索和LLM推理需要网络。

### C. 贡献指南

欢迎贡献代码/模板/文档！

**提交流程**:
1. Fork项目
2. 创建feature分支
3. 提交PR并描述改动
4. Code Review
5. 合并到主分支

**代码规范**:
- Python: PEP 8
- 类型注解: 必需
- 文档字符串: Google风格
- 测试覆盖率: > 80%
