# shell_executor vs code_executor æ·±åº¦å¯¹æ¯”åˆ†æž

## ç”¨æˆ·è´¨ç–‘
> "Claude Codeé‡Œç”¨çš„å¥½åƒæ˜¯bash()è¿™æ ·ä¸€ä¸ªtool,å®žçŽ°çš„æ˜¯æ‰€æœ‰ä»£ç å’Œå‘½ä»¤è¡Œçš„è¿è¡ŒåŠŸèƒ½,ä¸çŸ¥é“æ›´æŽ¥è¿‘æˆ‘ä»¬çš„å“ªä¸ªtool"

è¿™æ˜¯ä¸€ä¸ªéžå¸¸å…³é”®çš„æž¶æž„è®¾è®¡é—®é¢˜ã€‚æˆ‘éœ€è¦é‡æ–°å®¡è§†æˆ‘ä¹‹å‰"shell_executorè¢«code_executorè¦†ç›–"çš„åˆ¤æ–­ã€‚

---

## å·¥å…·å®žé™…å®žçŽ°å¯¹æ¯”

### code_executor
```python
# æ‰§è¡Œæ–¹å¼
subprocess.run([sys.executable, temp_file], cwd=work_dir)

# ç‰¹ç‚¹
- åªæ”¯æŒPythonä»£ç 
- ä»£ç å†™å…¥ä¸´æ—¶.pyæ–‡ä»¶åŽæ‰§è¡Œ
- æœ‰ç‰¹æ®Šä¼˜åŒ–ï¼šä¸­æ–‡å­—ä½“æ³¨å…¥ã€å¯¼å…¥ä¿®æ­£ã€è·¯å¾„æ¸…ç†
- é€‚åˆï¼šç¼–ç¨‹ä»»åŠ¡ã€æ•°æ®å¤„ç†ã€å¤æ‚é€»è¾‘
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# Agentéœ€è¦æä¾›å®Œæ•´çš„Pythonä»£ç 
import pandas as pd
df = pd.read_csv('data.csv')
print(df.describe())
```

### shell_executor
```python
# æ‰§è¡Œæ–¹å¼
subprocess.run(["bash", "-lc", cmd], cwd=work_dir)

# ç‰¹ç‚¹
- ç›´æŽ¥æ‰§è¡Œbashå‘½ä»¤
- æ”¯æŒshellè¯­æ³•ã€ç®¡é“ã€é‡å®šå‘ç­‰
- æœ‰å®‰å…¨é™åˆ¶ï¼šç¦æ­¢rmã€sudoã€pip installç­‰
- é€‚åˆï¼šå¿«é€Ÿå‘½ä»¤ã€æ‰¹é‡æ“ä½œã€ç³»ç»Ÿå·¥å…·è°ƒç”¨
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# Agentå¯ä»¥ç›´æŽ¥å†™bashå‘½ä»¤
find . -name "*.txt" | xargs wc -l
```

---

## å…³é”®å·®å¼‚åˆ†æž

| ç»´åº¦ | code_executor | shell_executor |
|------|--------------|----------------|
| **æ‰§è¡Œå†…å®¹** | Pythonä»£ç  | Bashå‘½ä»¤ |
| **è¯­æ³•** | Pythonè¯­æ³• | Shellè¯­æ³• |
| **ä½¿ç”¨åœºæ™¯** | ç¼–ç¨‹ä»»åŠ¡ã€æ•°æ®å¤„ç† | å¿«é€Ÿå‘½ä»¤ã€æ‰¹é‡æ“ä½œ |
| **å¤æ‚åº¦** | é€‚åˆå¤æ‚é€»è¾‘ | é€‚åˆç®€å•ä¸€æ¬¡æ€§æ“ä½œ |
| **åº“æ”¯æŒ** | Pythonç”Ÿæ€ï¼ˆpandas/numpy/matplotlibï¼‰ | ç³»ç»Ÿå·¥å…·ï¼ˆfind/grep/awk/sedï¼‰ |

---

## å…¸åž‹ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### åœºæ™¯1: æ‰¹é‡é‡å‘½åæ–‡ä»¶ï¼ˆ.txt â†’ .mdï¼‰

**ç”¨shell_executorï¼ˆ1è¡Œï¼‰**:
```bash
for f in *.txt; do mv "$f" "${f%.txt}.md"; done
```

**ç”¨code_executorï¼ˆ4è¡Œï¼‰**:
```python
import os
for f in os.listdir('.'):
    if f.endswith('.txt'):
        os.rename(f, f[:-4] + '.md')
```

**ç»“è®º**: shell_executoræ›´ç®€æ´ âœ…

---

### åœºæ™¯2: ç»Ÿè®¡æ‰€æœ‰Pythonæ–‡ä»¶çš„ä»£ç è¡Œæ•°

**ç”¨shell_executorï¼ˆ1è¡Œï¼‰**:
```bash
find . -name "*.py" -type f | xargs wc -l | tail -1
```

**ç”¨code_executorï¼ˆ7è¡Œï¼‰**:
```python
import os
import subprocess
result = subprocess.run(
    ['find', '.', '-name', '*.py', '-type', 'f'],
    capture_output=True, text=True
)
files = result.stdout.strip().split('\n')
total = sum(len(open(f).readlines()) for f in files if os.path.exists(f))
print(total)
```

**ç»“è®º**: shell_executoræ›´ç®€æ´ âœ…

---

### åœºæ™¯3: æ•°æ®åˆ†æžå’Œå¯è§†åŒ–

**ç”¨code_executor**:
```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('sales.csv')
df.groupby('category')['revenue'].sum().plot(kind='bar')
plt.savefig('chart.png')
```

**ç”¨shell_executor**: å‡ ä¹Žä¸å¯èƒ½ï¼ˆéœ€è¦è°ƒç”¨Pythonï¼‰

**ç»“è®º**: code_executoræ˜¯å”¯ä¸€é€‰æ‹© âœ…

---

### åœºæ™¯4: æŸ¥æ‰¾åŒ…å«ç‰¹å®šå…³é”®è¯çš„æ–‡ä»¶

**ç”¨shell_executorï¼ˆ1è¡Œï¼‰**:
```bash
grep -r "import pandas" --include="*.py" .
```

**ç”¨code_executorï¼ˆ5è¡Œï¼‰**:
```python
import subprocess
result = subprocess.run(
    ['grep', '-r', 'import pandas', '--include=*.py', '.'],
    capture_output=True, text=True
)
print(result.stdout)
```

**ç»“è®º**: shell_executoræ›´ç®€æ´ âœ…

---

## Claude Codeçš„è®¾è®¡ç†å¿µ

æ ¹æ®ä½ çš„æè¿°ï¼ŒClaude Codeä½¿ç”¨**å•ä¸€çš„bash()å·¥å…·**ã€‚è¿™æ„å‘³ç€ï¼š

### Claude Codeçš„bash()å·¥å…·
```
bash() å·¥å…· = shellå‘½ä»¤æ‰§è¡Œ + ä»£ç æ‰§è¡Œï¼ˆé€šè¿‡è°ƒç”¨pythonç­‰ï¼‰
```

**ç‰¹ç‚¹**:
- ç»Ÿä¸€çš„æ‰§è¡ŒæŽ¥å£
- Agentå¯ä»¥é€‰æ‹©ç›´æŽ¥å†™bashå‘½ä»¤ï¼Œæˆ–è€…ç”¨bashè°ƒç”¨python
- æ›´çµæ´»ï¼Œä½†éœ€è¦Agentè‡ªå·±å†³å®šä½•æ—¶ç”¨Python

**ç¤ºä¾‹**:
```bash
# ç›´æŽ¥æ‰§è¡Œshellå‘½ä»¤
ls -lh

# æˆ–è€…è°ƒç”¨Python
python -c "import pandas; print(pandas.__version__)"

# æˆ–è€…åˆ›å»ºPythonè„šæœ¬å¹¶æ‰§è¡Œ
cat > analysis.py << 'EOF'
import pandas as pd
df = pd.read_csv('data.csv')
print(df.describe())
EOF
python analysis.py
```

---

## ä¸¤ç§è®¾è®¡æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆA: ç»Ÿä¸€çš„bash()å·¥å…·ï¼ˆç±»ä¼¼Claude Codeï¼‰

**ä¼˜ç‚¹**:
- âœ… ç®€åŒ–å·¥å…·é›†ï¼ˆåªæœ‰1ä¸ªæ‰§è¡Œå·¥å…·ï¼‰
- âœ… Agentä¸éœ€è¦é€‰æ‹©"ç”¨Pythonè¿˜æ˜¯ç”¨Bash"
- âœ… æ›´çµæ´»ï¼Œå¯ä»¥æ··åˆä½¿ç”¨
- âœ… ç¬¦åˆ"Unixå“²å­¦"ï¼ˆä¸€åˆ‡çš†å‘½ä»¤ï¼‰

**ç¼ºç‚¹**:
- âŒ å®‰å…¨æ€§è¾ƒéš¾æŽ§åˆ¶ï¼ˆbashèƒ½åšçš„äº‹å¤ªå¤šï¼‰
- âŒ ç¼ºå°‘Pythonä»£ç çš„ç‰¹æ®Šä¼˜åŒ–ï¼ˆå¦‚æˆ‘ä»¬çš„ä¸­æ–‡å­—ä½“æ³¨å…¥ã€å¯¼å…¥ä¿®æ­£ï¼‰
- âŒ Agentéœ€è¦è‡ªå·±å†™ `python -c "..."` æˆ–åˆ›å»ºä¸´æ—¶æ–‡ä»¶
- âŒ å¯¹äºŽå¤æ‚Pythonä»»åŠ¡ï¼Œè¯­æ³•ä¼šå¾ˆç¹ç

### æ–¹æ¡ˆB: åˆ†ç¦»çš„code_executor + shell_executorï¼ˆæˆ‘ä»¬å½“å‰ï¼‰

**ä¼˜ç‚¹**:
- âœ… èŒè´£æ¸…æ™°ï¼šPythonä»»åŠ¡ç”¨code_executorï¼ŒShellä»»åŠ¡ç”¨shell_executor
- âœ… å¯ä»¥é’ˆå¯¹Pythonåšç‰¹æ®Šä¼˜åŒ–ï¼ˆä¸­æ–‡å­—ä½“ã€å¯¼å…¥ä¿®æ­£ï¼‰
- âœ… å®‰å…¨æŽ§åˆ¶æ›´ç²¾ç»†ï¼ˆPythonæ²™ç®± vs Shellé™åˆ¶ï¼‰
- âœ… Agentå¯ä»¥ç›´æŽ¥æä¾›Pythonä»£ç ï¼Œæ— éœ€bashåŒ…è£…

**ç¼ºç‚¹**:
- âŒ å¢žåŠ Agentçš„é€‰æ‹©è´Ÿæ‹…ï¼ˆä½•æ—¶ç”¨å“ªä¸ªå·¥å…·ï¼Ÿï¼‰
- âŒ æŸäº›ä»»åŠ¡å¯èƒ½ä¸¤ä¸ªéƒ½èƒ½åšï¼Œé€ æˆæ··æ·†
- âŒ å·¥å…·æ•°é‡æ›´å¤š

---

## å®žé™…ä½¿ç”¨é¢‘çŽ‡ä¼°ç®—

### åœ¨"åˆ›æ„å·¥ä½œæµè‡ªåŠ¨åŒ–åŠ©æ‰‹"åœºæ™¯ä¸­

**é¢„è®¡é«˜é¢‘ä½¿ç”¨**:
- âœ… code_executor: æ•°æ®åˆ†æžã€å›¾è¡¨ç”Ÿæˆã€å›¾åƒå¤„ç†ã€è§†é¢‘ç”Ÿæˆï¼ˆé«˜é¢‘ï¼‰
- âœ… MiniMax APIå·¥å…·: TTSã€å›¾åƒã€è§†é¢‘ã€éŸ³ä¹ç”Ÿæˆï¼ˆé«˜é¢‘ï¼‰
- âœ… web_search, url_fetch: ä¿¡æ¯æ£€ç´¢ï¼ˆé«˜é¢‘ï¼‰

**é¢„è®¡ä½Žé¢‘ä½¿ç”¨**:
- âš ï¸ shell_executor: æ‰¹é‡æ–‡ä»¶æ“ä½œã€å¿«é€ŸæŸ¥æ‰¾ï¼ˆä½Žé¢‘ï¼Ÿï¼‰

**å…³é”®é—®é¢˜**:
- åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œç”¨æˆ·å¤šä¹…ä¼šéœ€è¦"æ‰¹é‡é‡å‘½åæ–‡ä»¶"æˆ–"ç”¨grepæŸ¥æ‰¾"ï¼Ÿ
- å¦‚æžœå¾ˆå°‘ï¼Œshell_executorçš„ä»·å€¼å°±æœ‰é™

---

## æˆ‘çš„ä¿®æ­£ç»“è®º

### âŒ æˆ‘ä¹‹å‰çš„åˆ¤æ–­æ˜¯é”™è¯¯çš„

æˆ‘è¯´"shell_executorè¢«code_executorå®Œå…¨è¦†ç›–"æ˜¯**ä¸å‡†ç¡®çš„**ã€‚

**äº‹å®ž**:
1. shell_executorå’Œcode_executoræœ‰**ä¸åŒçš„é€‚ç”¨åœºæ™¯**
2. shell_executoråœ¨**å¿«é€Ÿå‘½ä»¤**åœºæ™¯ä¸‹æ›´ç®€æ´é«˜æ•ˆ
3. code_executoråœ¨**ç¼–ç¨‹ä»»åŠ¡**åœºæ™¯ä¸‹æ›´å¼ºå¤§

### âœ… æ­£ç¡®çš„åˆ†æžæ¡†æž¶

åº”è¯¥ä»Žä»¥ä¸‹è§’åº¦åˆ¤æ–­æ˜¯å¦ä¿ç•™shell_executorï¼š

#### 1. ä½¿ç”¨é¢‘çŽ‡åˆ¤æ–­
- **å¦‚æžœç”¨æˆ·ç»å¸¸éœ€è¦æ‰¹é‡æ–‡ä»¶æ“ä½œã€æŸ¥æ‰¾ã€grepç­‰** â†’ ä¿ç•™shell_executor
- **å¦‚æžœè¿™äº›åœºæ™¯å¾ˆå°‘å‡ºçŽ°** â†’ å¯ä»¥ç§»é™¤

#### 2. åœºæ™¯åŒ¹é…åˆ¤æ–­
- **Claude Code**: é€šç”¨å¼€å‘å·¥å…·ï¼Œéœ€è¦å¤§é‡shellæ“ä½œ â†’ ç»Ÿä¸€bash()å·¥å…·åˆç†
- **æˆ‘ä»¬**: åˆ›æ„å†…å®¹ç”Ÿæˆï¼Œå¯èƒ½shellæ“ä½œè¾ƒå°‘ â†’ åˆ†ç¦»è®¾è®¡ä¹Ÿåˆç†

#### 3. å®‰å…¨æ€§æƒè¡¡
- shell_executoræœ‰å®‰å…¨é™åˆ¶ï¼Œä½†ä»æœ‰é£Žé™©
- å¦‚æžœä¸å¸¸ç”¨ï¼Œç§»é™¤å¯ä»¥é™ä½Žæ”»å‡»é¢

---

## æœ€ç»ˆå»ºè®®

### å»ºè®®1: ä¿ç•™shell_executorï¼ˆä¿å®ˆæ–¹æ¡ˆï¼‰âœ…

**ç†ç”±**:
- åœ¨æŸäº›åœºæ™¯ä¸‹ç¡®å®žæ›´ç®€æ´ï¼ˆæ‰¹é‡æ“ä½œã€å¿«é€ŸæŸ¥æ‰¾ï¼‰
- å·²ç»å®žçŽ°äº†ï¼ŒåŠŸèƒ½ç¨³å®š
- ä¸Žcode_executoräº’è¡¥ï¼Œè€Œéžé‡å¤

**æ”¹è¿›æŽªæ–½**:
- ä¼˜åŒ–descriptionï¼Œæ˜Žç¡®ä¸Žcode_executorçš„åˆ†å·¥
- æ·»åŠ ä½¿ç”¨åœºæ™¯è¯´æ˜Ž

**ä¼˜åŒ–åŽçš„description**:
```python
description = (
    "Shellå‘½ä»¤æ‰§è¡Œ: åœ¨ä¼šè¯ç›®å½•ä¸­æ‰§è¡Œbashå‘½ä»¤ï¼ˆå®‰å…¨å—é™ï¼‰ã€‚"
    "é€‚ç”¨åœºæ™¯ï¼šæ‰¹é‡æ–‡ä»¶æ“ä½œï¼ˆé‡å‘½åã€å¤åˆ¶ï¼‰ã€å¿«é€ŸæŸ¥æ‰¾ï¼ˆfind/grepï¼‰ã€ç®¡é“å¤„ç†ã€ç³»ç»Ÿå·¥å…·è°ƒç”¨ã€‚"
    "ä¸é€‚ç”¨ï¼šç¼–ç¨‹ä»»åŠ¡ã€æ•°æ®å¤„ç†ã€éœ€è¦Pythonåº“çš„åœºæ™¯ï¼ˆä½¿ç”¨code_executorï¼‰ã€‚"
    "å®‰å…¨é™åˆ¶ï¼šç¦æ­¢rmã€sudoã€pip installç­‰å±é™©å‘½ä»¤ã€‚"
)
```

### å»ºè®®2: å…ˆè§‚å¯Ÿå†å†³å®šï¼ˆæŽ¨èæ–¹æ¡ˆï¼‰â­

**æ­¥éª¤**:
1. **ä¿ç•™shell_executorï¼Œæ·»åŠ ä½¿ç”¨ç»Ÿè®¡**
2. **è§‚å¯Ÿ1-2å‘¨çš„å®žé™…ä½¿ç”¨æ•°æ®**
3. **å¦‚æžœä½¿ç”¨é¢‘çŽ‡ < 5%ï¼Œè€ƒè™‘ç§»é™¤**

**ç»Ÿè®¡æ–¹æ³•**:
```python
# åœ¨ ToolRegistry.execute() ä¸­
logger.info(f"[TOOL_USAGE] {tool_name} called at {timestamp}")
```

### å»ºè®®3: å­¦ä¹ Claude Codeï¼Œåˆå¹¶ä¸ºbash()å·¥å…·ï¼ˆæ¿€è¿›æ–¹æ¡ˆï¼‰

**éœ€è¦é‡æ–°è®¾è®¡**:
- åˆ›å»ºç»Ÿä¸€çš„bash()å·¥å…·
- æ”¯æŒç›´æŽ¥bashå‘½ä»¤å’ŒPythonä»£ç æ‰§è¡Œ
- ä¿ç•™çŽ°æœ‰çš„ç‰¹æ®Šä¼˜åŒ–ï¼ˆå¦‚Pythonçš„ä¸­æ–‡å­—ä½“æ³¨å…¥ï¼‰

**ä¼˜ç‚¹**: ç®€åŒ–å·¥å…·é›†ï¼Œç¬¦åˆClaude Codeçš„è®¾è®¡ç†å¿µ
**ç¼ºç‚¹**: éœ€è¦å¤§é‡é‡æž„ï¼Œé£Žé™©è¾ƒé«˜

---

## æˆ‘çš„æŽ¨è

**æŽ¨èæ–¹æ¡ˆ2**: **å…ˆè§‚å¯Ÿå†å†³å®š**

ç†ç”±ï¼š
1. ä¸æ­¦æ–­åœ°ç§»é™¤ï¼ŒåŸºäºŽæ•°æ®åšå†³ç­–
2. ä¿ç•™çµæ´»æ€§ï¼Œå¯ä»¥éšæ—¶è°ƒæ•´
3. é£Žé™©æœ€å°ï¼Œæˆæœ¬æœ€ä½Ž

å…·ä½“å®žæ–½ï¼š
1. âœ… ä¿ç•™shell_executorï¼ˆæš‚ä¸ç§»é™¤ï¼‰
2. âœ… ä¼˜åŒ–descriptionæ˜Žç¡®ä½¿ç”¨åœºæ™¯
3. â³ æ·»åŠ å·¥å…·ä½¿ç”¨ç»Ÿè®¡æ—¥å¿—
4. â³ 1-2å‘¨åŽæ ¹æ®æ•°æ®å†³å®š

---

## å…³é”®ç»éªŒæ•™è®­

1. **ä¸è¦æ­¦æ–­åœ°åˆ¤æ–­å·¥å…·é‡å¤** - éœ€è¦æ·±å…¥åˆ†æžå®žé™…ä½¿ç”¨åœºæ™¯
2. **å‚è€ƒä¸šç•Œæœ€ä½³å®žè·µ** - Claude Codeçš„è®¾è®¡å€¼å¾—å­¦ä¹ ï¼Œä½†ä¸ä¸€å®šå®Œå…¨é€‚ç”¨
3. **åŸºäºŽæ•°æ®åšå†³ç­–** - ä½¿ç”¨ç»Ÿè®¡æ¯”ä¸»è§‚åˆ¤æ–­æ›´å¯é 
4. **åœºæ™¯å†³å®šæž¶æž„** - é€šç”¨å¼€å‘å·¥å…· vs åˆ›æ„å†…å®¹ç”Ÿæˆï¼Œéœ€æ±‚ä¸åŒ

æ„Ÿè°¢ä½ çš„è´¨ç–‘ï¼Œè®©æˆ‘é¿å…äº†ä¸€ä¸ªé”™è¯¯çš„å†³ç­–ï¼ðŸ™
